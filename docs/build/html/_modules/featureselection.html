

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>featureselection &mdash; Comprior  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Comprior
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation and Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inputdata.html">Input Data Sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configparams.html">Configuration Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../outputstructure.html">Output Folder Structure  - Where to find what Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledgebases.html">Knowledge Bases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../priorknowledge.html">Prior Knowledge Approaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos.html">How-Tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../comprior.html">Python Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../r-doc.html">R Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../java-doc.html">Java Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">System Architecture</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Comprior</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>featureselection</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for featureselection</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">benchutils</span> <span class="k">as</span> <span class="nn">utils</span>
<span class="kn">import</span> <span class="nn">knowledgebases</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">SelectKBest</span><span class="p">,</span> <span class="n">f_classif</span><span class="p">,</span> <span class="n">SelectFromModel</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="k">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">mlxtend.feature_selection</span> <span class="k">import</span> <span class="n">SequentialFeatureSelector</span> <span class="k">as</span> <span class="n">SFS</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="k">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="k">import</span> <span class="n">LinearSVC</span><span class="p">,</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="k">import</span> <span class="n">MultinomialNB</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">RFE</span><span class="p">,</span> <span class="n">VarianceThreshold</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">preprocessing</span>
<span class="kn">import</span> <span class="nn">pypath.core.network</span> <span class="k">as</span> <span class="nn">network</span>
<span class="kn">import</span> <span class="nn">pypath.core.entity</span> <span class="k">as</span> <span class="nn">entity</span>


<div class="viewcode-block" id="FeatureSelectorFactory"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelectorFactory">[docs]</a><span class="k">class</span> <span class="nc">FeatureSelectorFactory</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Singleton class.</span>
<span class="sd">       Python code encapsulates it in a way that is not shown in Sphinx, so have a look at the descriptions in the source code.</span>

<span class="sd">       Creates feature selector object based on a given name.</span>
<span class="sd">       New feature selection approaches must be registered here.</span>
<span class="sd">       Names for feature selectors must follow to a particular scheme, with keywords separated by _:</span>
<span class="sd">       - first keyword is the actual selector name</span>
<span class="sd">       - if needed, second keyword is the knowledge base</span>
<span class="sd">       - if needed, third keyword is the (traditional) approach to be combined</span>
<span class="sd">       Examples:</span>
<span class="sd">       - Traditional Approaches have only one keyword, e.g. InfoGain or ANOVA</span>
<span class="sd">       - LassoPenalty_KEGG provides KEGG information to the LassoPenalty feature selection approach</span>
<span class="sd">       - Weighted_KEGG_InfoGain --&gt; Factory creates an instance of KBweightedSelector which uses KEGG as knowledge base and InfoGain as traditional selector.</span>
<span class="sd">       While the focus here lies on the combination of traditional approaches with prior biological knowledge, it is theoretically possible to use ANY selector object for combination that inherits from :class:`FeatureSelector`.</span>

<span class="sd">       :param config: configuration parameters for UMLS web service as specified in config file.</span>
<span class="sd">       :type config: dict</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">__FeatureSelectorFactory</span><span class="p">():</span>

        <span class="k">def</span> <span class="nf">createFeatureSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Create selector from a given name.</span>
<span class="sd">               Separates creation process into (traditional) approaches (only one keyword), approaches requiring a knowledge base, and approaches requiring both a knowledge base and another selector, e.g. a traditional one.</span>

<span class="sd">               :param name: selector name following the naming conventions: first keyword is the actual selector name, second keyword is the knowledge base, third keyword another selector to combine. Keywords must be separated by &quot;_&quot;. Example: Weighted_KEGG_InfoGain</span>
<span class="sd">               :type name: str</span>
<span class="sd">               :return: instance of a feature selector implementation.</span>
<span class="sd">               :rtype: :class:`FeatureSelector` or inheriting class</span>
<span class="sd">               &quot;&quot;&quot;</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">createTraditionalSelector</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">createIntegrativeSelector</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">createCombinedSelector</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The provided selector name does not correspond to the expected format. &quot;</span>
                  <span class="s2">&quot;A selector name should consist of one or more keywords separated by _. &quot;</span>
                  <span class="s2">&quot;The first keyword is the actual approach (e.g. weighted, or a traditional approach), &quot;</span>
                  <span class="s2">&quot;the second keyword corresponds to a knowledge base to use (e.g. KEGG),&quot;</span>
                  <span class="s2">&quot;the third keyword corresponds to a traditional selector to use (e.g. when using a modifying or combining approach&quot;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">createTraditionalSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selectorName</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Creates a (traditional) selector (without a knowledge base) from a given name.</span>
<span class="sd">               Register new implementations of a (traditional) selector here.</span>
<span class="sd">               Stops processing if the selector could not be found.</span>

<span class="sd">               :param selectorName: selector name</span>
<span class="sd">               :type selectorName: str</span>
<span class="sd">               :return: instance of a feature selector implementation.</span>
<span class="sd">               :rtype: :class:`FeatureSelector` or inheriting class</span>
<span class="sd">               &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;Random&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RandomSelector</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;VB-FS&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">VarianceSelector</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;Variance&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Variance2Selector</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;ANOVA&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">AnovaSelector</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;mRMR&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">MRMRSelector</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;SVMpRFE&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SVMRFESelector</span><span class="p">()</span>
            <span class="c1"># RUN WEKA FEATURE SELECTION AS SELECTED</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;InfoGain&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">InfoGainSelector</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;ReliefF&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ReliefFSelector</span><span class="p">()</span>
            <span class="c1">#if &quot;-RFE&quot; in selectorName or &quot;-SFS&quot; in selectorName: -- SFS is currently disabled because sometimes the coef_ param is missing and error is thrown</span>
            <span class="k">if</span> <span class="s2">&quot;-RFE&quot;</span> <span class="ow">in</span> <span class="n">selectorName</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">WrapperSelector</span><span class="p">(</span><span class="n">selectorName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;Lasso&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">LassoSelector</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;RandomForest&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RandomForestSelector</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The listed selector &quot;</span> <span class="o">+</span> <span class="n">selectorName</span> <span class="o">+</span> <span class="s2">&quot; is not available. See the documentation for available selectors. Stop execution.&quot;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">createIntegrativeSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selectorName</span><span class="p">,</span> <span class="n">kb</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Creates a feature selector using a knowledge base from the given selector and knowledge base names.</span>
<span class="sd">               Register new implementations of a prior knowledge selector here that does not requires a (traditional) selector.</span>
<span class="sd">               Stops processing if the selector could not be found.</span>

<span class="sd">               :param selectorName: selector name</span>
<span class="sd">               :type selectorName: str</span>
<span class="sd">               :param kb: knowledge base name</span>
<span class="sd">               :type kb: str</span>
<span class="sd">               :return: instance of a feature selector implementation.</span>
<span class="sd">               :rtype: :class:`FeatureSelector` or inheriting class</span>
<span class="sd">               &quot;&quot;&quot;</span>
            <span class="n">kbfactory</span> <span class="o">=</span> <span class="n">knowledgebases</span><span class="o">.</span><span class="n">KnowledgeBaseFactory</span><span class="p">()</span>
            <span class="n">knowledgebase</span> <span class="o">=</span> <span class="n">kbfactory</span><span class="o">.</span><span class="n">createKnowledgeBase</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;NetworkActivity&quot;</span><span class="p">:</span>
                <span class="n">featuremapper</span> <span class="o">=</span> <span class="n">PathwayActivityMapper</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">NetworkActivitySelector</span><span class="p">(</span><span class="n">knowledgebase</span><span class="p">,</span> <span class="n">featuremapper</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;CorgsNetworkActivity&quot;</span><span class="p">:</span>
                <span class="n">featuremapper</span> <span class="o">=</span> <span class="n">CORGSActivityMapper</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">NetworkActivitySelector</span><span class="p">(</span><span class="n">knowledgebase</span><span class="p">,</span> <span class="n">featuremapper</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;LassoPenalty&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">LassoPenalty</span><span class="p">(</span><span class="n">knowledgebase</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;KBonly&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">KbSelector</span><span class="p">(</span><span class="n">knowledgebase</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The listed selector &quot;</span> <span class="o">+</span> <span class="n">selectorName</span> <span class="o">+</span> <span class="s2">&quot; is not available. See the documentation for available selectors. Stop execution.&quot;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">createCombinedSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selectorName</span><span class="p">,</span> <span class="n">trad</span><span class="p">,</span> <span class="n">kb</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Creates a feature selector that combines a knowledge base and another feature selector based on the given names.</span>
<span class="sd">               Register new implementations of a prior knowledge selector that requires another selector here.</span>
<span class="sd">               Stops processing if the selector could not be found.</span>

<span class="sd">               :param selectorName: selector name</span>
<span class="sd">               :type selectorName: str</span>
<span class="sd">               :param trad: name of the (traditional) feature selector.</span>
<span class="sd">               :type trad: str</span>
<span class="sd">               :param kb: knowledge base name</span>
<span class="sd">               :type kb: str</span>
<span class="sd">               :return: instance of a feature selector implementation.</span>
<span class="sd">               :rtype: :class:`FeatureSelector` or inheriting class</span>
<span class="sd">               &quot;&quot;&quot;</span>
            <span class="n">tradSelector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createTraditionalSelector</span><span class="p">(</span><span class="n">trad</span><span class="p">)</span>
            <span class="n">kbfactory</span> <span class="o">=</span> <span class="n">knowledgebases</span><span class="o">.</span><span class="n">KnowledgeBaseFactory</span><span class="p">()</span>
            <span class="n">knowledgebase</span> <span class="o">=</span> <span class="n">kbfactory</span><span class="o">.</span><span class="n">createKnowledgeBase</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;Postfilter&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">PostFilterSelector</span><span class="p">(</span><span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradSelector</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;Prefilter&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">PreFilterSelector</span><span class="p">(</span><span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradSelector</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;Extension&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ExtensionSelector</span><span class="p">(</span><span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradSelector</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selectorName</span> <span class="o">==</span> <span class="s2">&quot;Weighted&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">KBweightedSelector</span><span class="p">(</span><span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradSelector</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The listed selector &quot;</span> <span class="o">+</span> <span class="n">selectorName</span> <span class="o">+</span> <span class="s2">&quot; is not available. See the documentation for available selectors. Stop execution.&quot;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>

    <span class="n">instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">FeatureSelectorFactory</span><span class="o">.</span><span class="n">instance</span><span class="p">:</span>
            <span class="n">FeatureSelectorFactory</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">FeatureSelectorFactory</span><span class="o">.</span><span class="n">__FeatureSelectorFactory</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureSelector"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector">[docs]</a><span class="k">class</span> <span class="nc">FeatureSelector</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Abstract super class for feature selection functionality.</span>
<span class="sd">       Every feature selection class has to inherit from this class and implement its :meth:`FeatureSelector.selectFeatures` method and - if necessary - its :meth:`FeatureSelector.setParams` method.</span>
<span class="sd">       Once created, feature selection can be triggered by first setting parameters (input, output, etc) as needed with :meth:`FeatureSelector.setParams`.</span>
<span class="sd">       The actual feature selection is triggered by invoking :meth:`FeatureSelector.selectFeatures`.</span>

<span class="sd">       :param input: absolute path to input dataset.</span>
<span class="sd">       :type input: str</span>
<span class="sd">       :param output: absolute path to output directory (where the ranking will be stored).</span>
<span class="sd">       :type output: str</span>
<span class="sd">       :param dataset: the dataset for which to select features. Will be loaded dynamically based on self.input at first usage.</span>
<span class="sd">       :type dataset: :class:`pandas.DataFrame`</span>
<span class="sd">       :param dataConfig: config parameters for input data set.</span>
<span class="sd">       :type dataConfig: dict</span>
<span class="sd">       :param name: selector name</span>
<span class="sd">       :type name: str</span>
<span class="sd">       &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataConfig</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="s2">&quot;Dataset&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLogs</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">createLog</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

<div class="viewcode-block" id="FeatureSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.selectFeatures">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract.</span>
<span class="sd">           Invoke feature selection functionality in this method when implementing a new selector</span>

<span class="sd">           :return: absolute path to the output ranking file.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="FeatureSelector.getTimeLogs"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.getTimeLogs">[docs]</a>    <span class="k">def</span> <span class="nf">getTimeLogs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all logs for this selector.</span>

<span class="sd">           :return: dataframe of logged events containing start/end time, duration, and a short description.</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span></div>

<div class="viewcode-block" id="FeatureSelector.setTimeLogs"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.setTimeLogs">[docs]</a>    <span class="k">def</span> <span class="nf">setTimeLogs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newTimeLogs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overwrites the current logs with new ones.</span>

<span class="sd">           :param newTimeLogs: new dataframe of logged events containing start/end time, duration, and a short description.</span>
<span class="sd">           :type newTimeLogs: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">newTimeLogs</span></div>

<div class="viewcode-block" id="FeatureSelector.disableLogFlush"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.disableLogFlush">[docs]</a>    <span class="k">def</span> <span class="nf">disableLogFlush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disables log flushing (i.e., writing the log to a separate file) of the selector at the end of feature selection.</span>
<span class="sd">           This is needed when a :class:`CombiningSelector` uses a second selector and wants to avoid that its log messages are written, potentially overwriting logs from another selector of the same name.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FeatureSelector.enableLogFlush"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.enableLogFlush">[docs]</a>    <span class="k">def</span> <span class="nf">enableLogFlush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enables log flushing, i.e. writing the logs to a separate file at the end of feature selection.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FeatureSelector.getName"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the selector&#39;s name.</span>

<span class="sd">           :return: selector name.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>

<div class="viewcode-block" id="FeatureSelector.getData"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the labeled dataset from which to select features.</span>

<span class="sd">           :return: dataframe containing the dataset with class labels.</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span></div>

<div class="viewcode-block" id="FeatureSelector.getUnlabeledData"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.getUnlabeledData">[docs]</a>    <span class="k">def</span> <span class="nf">getUnlabeledData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the dataset without labels.</span>

<span class="sd">           :return: dataframe containing the dataset without class labels.</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s2">&quot;classLabel&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="FeatureSelector.getFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.getFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">getFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets features from the dataset.</span>

<span class="sd">           :return: list of features.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></div>

<div class="viewcode-block" id="FeatureSelector.getUniqueLabels"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.getUniqueLabels">[docs]</a>    <span class="k">def</span> <span class="nf">getUniqueLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the unique class labels available in the dataset.</span>

<span class="sd">           :return: list of distinct class labels.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getLabels</span><span class="p">()))</span></div>

<div class="viewcode-block" id="FeatureSelector.getLabels"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.getLabels">[docs]</a>    <span class="k">def</span> <span class="nf">getLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the labels in the data set.</span>

<span class="sd">           :return: all labels from the dataset.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">()[</span><span class="s2">&quot;classLabel&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="FeatureSelector.setParams"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.setParams">[docs]</a>    <span class="k">def</span> <span class="nf">setParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputPath</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span> <span class="n">loggingDir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets parameters for the feature selection run: path to the input datast and path to the output directory.</span>

<span class="sd">           :param inputPath: absolute path to the input file containing the dataset for analysis.</span>
<span class="sd">           :type inputPath: str</span>
<span class="sd">           :param outputDir: absolute path to the output directory (where to store the ranking)</span>
<span class="sd">           :type outputDir: str</span>
<span class="sd">           :param loggingDir: absolute path to the logging directory (where to store log files)</span>
<span class="sd">           :type loggingDir: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">inputPath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">outputDir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">=</span> <span class="n">loggingDir</span></div>

<div class="viewcode-block" id="FeatureSelector.writeRankingToFile"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureSelector.writeRankingToFile">[docs]</a>    <span class="k">def</span> <span class="nf">writeRankingToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes a given ranking to a specified file.</span>

<span class="sd">           :param ranking: dataframe with the ranking.</span>
<span class="sd">           :type ranking: :class:`pandas.DataFrame`</span>
<span class="sd">           :param outputFile: absolute path of the file where ranking will be stored.</span>
<span class="sd">           :type outputFile: str</span>
<span class="sd">           :param index: whether to write the dataframe&#39;s index or not.</span>
<span class="sd">           :type index: bool, default False</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ranking</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">ranking</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#make sure to write at least the header if the dataframe is empty</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                <span class="n">header_line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">attributeName</span><span class="se">\&quot;\t\&quot;</span><span class="s2">score</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header_line</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="PythonSelector"><a class="viewcode-back" href="../comprior.html#featureselection.PythonSelector">[docs]</a><span class="k">class</span> <span class="nc">PythonSelector</span><span class="p">(</span><span class="n">FeatureSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract.</span>
<span class="sd">       Inherit from this class when implementing a feature selector using any of scikit-learn&#39;s functionality.</span>
<span class="sd">       As functionality invocation, input preprocessing and output postprocessing are typically very similar/the same for such implementations, this class already encapsulates it.</span>
<span class="sd">       Instead of implementing :meth:`PythonSelector.selectFeatures`, implement :meth:`PythonSelector.runSelector`.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="PythonSelector.runSelector"><a class="viewcode-back" href="../comprior.html#featureselection.PythonSelector.runSelector">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">runSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract - implement this method when inheriting from this class.</span>
<span class="sd">           Runs the actual feature selector of scikit-learn.</span>
<span class="sd">           Is invoked by :meth:`PythonSelector.selectFeatures`.</span>

<span class="sd">           :param data: dataframe containing the unlabeled dataset.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param labels: numerically encoded class labels.</span>
<span class="sd">           :type labels: list of int</span>
<span class="sd">           :return: sklearn/mlxtend selector that ran the selection (containing coefficients etc.).</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PythonSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.PythonSelector.selectFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes the feature selection procedure.</span>
<span class="sd">           Prepares the input data set to match scikit-learn&#39;s expected formats and postprocesses the output to create a ranking.</span>

<span class="sd">           :return: absolute path to the output ranking file.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;... ########################&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="n">outputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="n">filename</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepareInput</span><span class="p">()</span>

        <span class="n">selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSelector</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prepareOutput</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Feature Selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">flushLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; finished ########################&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputFile</span></div>

<div class="viewcode-block" id="PythonSelector.prepareInput"><a class="viewcode-back" href="../comprior.html#featureselection.PythonSelector.prepareInput">[docs]</a>    <span class="k">def</span> <span class="nf">prepareInput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepares the input data set before running any of scikit-learn&#39;s selectors.</span>
<span class="sd">           Removes the labels from the input data set and encodes the labels in numbers.</span>

<span class="sd">           :return: dataset (without labels) and labels encoded in numbers.</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame` and list of int</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLabels</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUnlabeledData</span><span class="p">()</span>
        <span class="n">le</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">LabelEncoder</span><span class="p">()</span>
        <span class="n">numeric_labels</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Input Preparation&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">numeric_labels</span></div>

<div class="viewcode-block" id="PythonSelector.prepareOutput"><a class="viewcode-back" href="../comprior.html#featureselection.PythonSelector.prepareOutput">[docs]</a>    <span class="k">def</span> <span class="nf">prepareOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transforms the selector output to a valid ranking and stores it into the specified file.</span>

<span class="sd">           :param outputFile: absolute path of the file to which to write the ranking.</span>
<span class="sd">           :type outputFile: str</span>
<span class="sd">           :param data: input dataset.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param selector: selector object from scikit-learn.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">scores_</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">ranking</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeRankingToFile</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Output Preparation&quot;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="RSelector"><a class="viewcode-back" href="../comprior.html#featureselection.RSelector">[docs]</a><span class="k">class</span> <span class="nc">RSelector</span><span class="p">(</span><span class="n">FeatureSelector</span><span class="p">,</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Selector class for invoking R code for feature selection.</span>
<span class="sd">       Inherit from this class if you want to use R code, implement :meth:`RSelector.createParams` with what your script requires, and set self.scriptName accordingly.</span>

<span class="sd">       :param rConfig: config parameters to execute R code.</span>
<span class="sd">       :type rConfig: dict</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rConfig</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scriptName</span> <span class="o">=</span> <span class="s2">&quot;FS_&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.R&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="RSelector.createParams"><a class="viewcode-back" href="../comprior.html#featureselection.RSelector.createParams">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">createParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract.</span>
<span class="sd">           Implement this method to set the parameters your R script requires.</span>

<span class="sd">           :param filename: absolute path of the output file.</span>
<span class="sd">           :type filename: str</span>
<span class="sd">           :return: list of parameters to use for R code execution, e.g. input and output filenames.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="RSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.RSelector.selectFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers the feature selection.</span>
<span class="sd">           Actually a wrapper method that invokes external R code.</span>

<span class="sd">           :return: absolute path to the result file containing the ranking.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;... ########################&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="n">outputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createParams</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">runRCommand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rConfig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scriptName</span> <span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Feature Selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">flushLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; finished ########################&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filename</span></div></div>

<div class="viewcode-block" id="JavaSelector"><a class="viewcode-back" href="../comprior.html#featureselection.JavaSelector">[docs]</a><span class="k">class</span> <span class="nc">JavaSelector</span><span class="p">(</span><span class="n">FeatureSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Selector class for invoking R code for feature selection.</span>
<span class="sd">       Inherit from this class if you want to use R code, implement :meth:`RSelector.createParams` with what your script requires, and set self.scriptName accordingly.</span>

<span class="sd">       :param javaConfig: config parameters to execute java code.</span>
<span class="sd">       :type javaConfig: dict</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">javaConfig</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="s2">&quot;Java&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="JavaSelector.createParams"><a class="viewcode-back" href="../comprior.html#featureselection.JavaSelector.createParams">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">createParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract.</span>
<span class="sd">           Implement this method to set the parameters your java code requires.</span>

<span class="sd">           :return: list of parameters to use for java code execution, e.g. input and output filenames.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="JavaSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.JavaSelector.selectFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers the feature selection.</span>
<span class="sd">           Actually a wrapper method that invokes external java code.</span>

<span class="sd">           :return: absolute path to the result file containing the ranking.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;... ########################&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createParams</span><span class="p">()</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">runJavaCommand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">javaConfig</span><span class="p">,</span> <span class="s2">&quot;/WEKA_FeatureSelector.jar&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">output_filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Feature Selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">flushLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; finished ########################&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_filepath</span></div></div>

<span class="c1">############################### PRIOR KNOWLEDGE SELECTORS ###############################</span>
<div class="viewcode-block" id="PriorKnowledgeSelector"><a class="viewcode-back" href="../comprior.html#featureselection.PriorKnowledgeSelector">[docs]</a><span class="k">class</span> <span class="nc">PriorKnowledgeSelector</span><span class="p">(</span><span class="n">FeatureSelector</span><span class="p">,</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Super class for all prior knowledge approaches.</span>
<span class="sd">       If you want to implement an own prior knowledge approach that uses a knowledge base (but not a second selector and no network approaches), inherit from this class.</span>

<span class="sd">       :param knowledgebase: instance of a knowledge base.</span>
<span class="sd">       :type knowledgebase: :class:`knowledgebases.KnowledgeBase` or inheriting class</span>
<span class="sd">       :param alternativeSearchTerms: list of alternative search terms to use for querying the knowledge base.</span>
<span class="sd">       :type alternativeSearchTerms: list of str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span> <span class="o">=</span> <span class="n">knowledgebase</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alternativeSearchTerms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectAlternativeSearchTerms</span><span class="p">()</span>


<div class="viewcode-block" id="PriorKnowledgeSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.PriorKnowledgeSelector.selectFeatures">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract.</span>
<span class="sd">           Implement this method when inheriting from this class.</span>

<span class="sd">           :return: absolute path to the output ranking file.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PriorKnowledgeSelector.collectAlternativeSearchTerms"><a class="viewcode-back" href="../comprior.html#featureselection.PriorKnowledgeSelector.collectAlternativeSearchTerms">[docs]</a>    <span class="k">def</span> <span class="nf">collectAlternativeSearchTerms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all alternative search terms that were specified in the config file and put them into a list.</span>

<span class="sd">           :return: list of alternative search terms to use for querying the knowledge base.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">alternativeTerms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataConfig</span><span class="p">[</span><span class="s2">&quot;alternativeSearchTerms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">searchTerms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">alternativeTerms</span><span class="p">:</span>
            <span class="n">searchTerms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">searchTerms</span></div>

<div class="viewcode-block" id="PriorKnowledgeSelector.getSearchTerms"><a class="viewcode-back" href="../comprior.html#featureselection.PriorKnowledgeSelector.getSearchTerms">[docs]</a>    <span class="k">def</span> <span class="nf">getSearchTerms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all search terms to use for querying a knowledge base.</span>
<span class="sd">           Search terms that will be used are a) the class labels in the dataset, and b) the alternative search terms that were specified in the config file.</span>

<span class="sd">           :return: list of search terms to use for querying the knowledge base.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">searchTerms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getUniqueLabels</span><span class="p">())</span>
        <span class="n">searchTerms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alternativeSearchTerms</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">searchTerms</span></div>

<div class="viewcode-block" id="PriorKnowledgeSelector.getName"><a class="viewcode-back" href="../comprior.html#featureselection.PriorKnowledgeSelector.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the full name (including applied knowledge base) of this selector.</span>

<span class="sd">           :return: selector name.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span></div></div>

<span class="c1">#selector class for modifying integrative approaches</span>
<div class="viewcode-block" id="CombiningSelector"><a class="viewcode-back" href="../comprior.html#featureselection.CombiningSelector">[docs]</a><span class="k">class</span> <span class="nc">CombiningSelector</span><span class="p">(</span><span class="n">PriorKnowledgeSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Super class for prior knoweldge approaches that use a knowledge base AND combine it with any kind of selector, e.g. a traditional approach.</span>
<span class="sd">       Inherit from this class if you want to implement a feature selector that requires both a knowledge base and another selector, e.g. because it combines information from both.</span>

<span class="sd">       :param knowledgebase: instance of a knowledge base.</span>
<span class="sd">       :type knowledgebase: :class:`knowledgebases.KnowledgeBase` or inheriting class</span>
<span class="sd">       :param tradApproach: any feature selector implementation to use internally, e.g. a traditional approach like ANOVA</span>
<span class="sd">       :type tradApproach: :class:`FeatureSelector`</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradApproach</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span> <span class="o">=</span> <span class="n">tradApproach</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">disableLogFlush</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">setTimeLogs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">)</span>

<div class="viewcode-block" id="CombiningSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.CombiningSelector.selectFeatures">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract.</span>
<span class="sd">           Implement this method as desired when inheriting from this class.</span>

<span class="sd">           :return: absolute path to the output ranking file.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CombiningSelector.getName"><a class="viewcode-back" href="../comprior.html#featureselection.CombiningSelector.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the full name (including applied knowledge base and feature selector) of this selector.</span>

<span class="sd">           :returns: selector name.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span></div>

<div class="viewcode-block" id="CombiningSelector.getExternalGenes"><a class="viewcode-back" href="../comprior.html#featureselection.CombiningSelector.getExternalGenes">[docs]</a>    <span class="k">def</span> <span class="nf">getExternalGenes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all genes related to the provided search terms from the knowledge base.</span>

<span class="sd">           :returns: list of gene names.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">externalGenes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getRelevantGenes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSearchTerms</span><span class="p">())</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Getting External Genes&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">externalGenes</span></div></div>

<div class="viewcode-block" id="NetworkSelector"><a class="viewcode-back" href="../comprior.html#featureselection.NetworkSelector">[docs]</a><span class="k">class</span> <span class="nc">NetworkSelector</span><span class="p">(</span><span class="n">PriorKnowledgeSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract.</span>
<span class="sd">       Inherit from this method if you want to implement a new network approach that actually conducts feature EXTRACTION, i.e. maps the original data set to have pathway/subnetworks.</span>
<span class="sd">       Instead of  :meth:`FeatureSelector.selectFeatures` implement :meth:`NetworkSelector.selectPathways` when inheriting from this class.</span>

<span class="sd">       Instances of :class:`NetworkSelector` and inheriting classes also require a :class:`PathwayMapper` object that transfers the dataset to the new feature space.</span>
<span class="sd">       Custom implementations thus need to implement a) a selection strategy to select pathways and b) a mapping strategy to compute new feature values for the selected pathways.</span>

<span class="sd">       :param featureMapper: feature mapping object that transfers the feature space.</span>
<span class="sd">       :type featureMapper: :class:`FeatureMapper` or inheriting class</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">featuremapper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureMapper</span> <span class="o">=</span> <span class="n">featuremapper</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">)</span>

<div class="viewcode-block" id="NetworkSelector.selectPathways"><a class="viewcode-back" href="../comprior.html#featureselection.NetworkSelector.selectPathways">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">selectPathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathways</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Selects the pathways that will become the new features of the data set.</span>
<span class="sd">           Implement this method (instead of :meth:`FeatureSelector.selectFeatures` when inheriting from this class.</span>

<span class="sd">           :param pathways: dict of pathways (pathway names as keys) to select from.</span>
<span class="sd">           :type pathways: dict</span>
<span class="sd">           :returns: pathway ranking as dataframe</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="NetworkSelector.writeMappedFile"><a class="viewcode-back" href="../comprior.html#featureselection.NetworkSelector.writeMappedFile">[docs]</a>    <span class="k">def</span> <span class="nf">writeMappedFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapped_data</span><span class="p">,</span> <span class="n">fileprefix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes the mapped dataset with new feature values to the same directory as the original file is located (it will be automatically processed then).</span>

<span class="sd">           :param mapped_data: dataframe containing the dataset with mapped feature space.</span>
<span class="sd">           :type mapped_data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param fileprefix: prefix of the file name, e.g. the directory path</span>
<span class="sd">           :type fileprefix: str</span>
<span class="sd">           :return: absolute path of the file name to store the mapped data set.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">mapped_filepath</span> <span class="o">=</span> <span class="n">fileprefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="n">mapped_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">mapped_filepath</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mapped_filepath</span></div>


<div class="viewcode-block" id="NetworkSelector.getName"><a class="viewcode-back" href="../comprior.html#featureselection.NetworkSelector.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the selector name (including the knowledge base).</span>

<span class="sd">           :returns: selector name.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span></div>

<div class="viewcode-block" id="NetworkSelector.filterPathways"><a class="viewcode-back" href="../comprior.html#featureselection.NetworkSelector.filterPathways">[docs]</a>    <span class="k">def</span> <span class="nf">filterPathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathways</span><span class="p">):</span>
        <span class="n">filtered_pathways</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pathwayName</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
            <span class="n">genes</span> <span class="o">=</span> <span class="n">pathways</span><span class="p">[</span><span class="n">pathwayName</span><span class="p">]</span><span class="o">.</span><span class="n">nodes_by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="c1">#check if there is an overlap between the pathway and data set genes</span>
            <span class="n">existingGenes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">genes</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existingGenes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">filtered_pathways</span><span class="p">[</span><span class="n">pathwayName</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathways</span><span class="p">[</span><span class="n">pathwayName</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No genes of pathway &quot;</span> <span class="o">+</span> <span class="n">pathwayName</span> <span class="o">+</span> <span class="s2">&quot; found in dataset. Pathway will not be considered&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered_pathways</span></div>

<div class="viewcode-block" id="NetworkSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.NetworkSelector.selectFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Instead of selecting existing features, instances of :class:`NetworkSelector` select pathways or submodules as features.</span>
<span class="sd">           For that, it first queries its knowledge base for pathways.</span>
<span class="sd">           It then selects the top k pathways (strategy to be implemented in :meth:`NetworkSelector.selectPathways`) and subsequently maps the dataset to its new feature space.</span>
<span class="sd">           The mapping will be conducted by an object of :class:`PathwayMapper` or inheriting classes.</span>
<span class="sd">           If a second dataset for cross-validation is available, the feature space of this dataset will also be transformed.</span>

<span class="sd">           :returns: absolute path to the pathway ranking.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;... ########################&quot;</span><span class="p">)</span>
        <span class="n">overallstart</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">pathways</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getRelevantPathways</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSearchTerms</span><span class="p">())</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">overallstart</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Get Pathways&quot;</span><span class="p">)</span>

        <span class="c1">#filter pathways to only those that contain at least one gene from the data set</span>
        <span class="n">pathways</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterPathways</span><span class="p">(</span><span class="n">pathways</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">pathwayRanking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectPathways</span><span class="p">(</span><span class="n">pathways</span><span class="p">)</span>
        <span class="n">outputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeRankingToFile</span><span class="p">(</span><span class="n">pathwayRanking</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Pathway Selection&quot;</span><span class="p">)</span>

        <span class="n">pathwayNames</span> <span class="o">=</span> <span class="n">pathwayRanking</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">mapped_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureMapper</span><span class="o">.</span><span class="n">mapFeatures</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">(),</span> <span class="n">pathways</span><span class="p">)</span>
        <span class="n">fileprefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mapped_filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeMappedFile</span><span class="p">(</span><span class="n">mapped_data</span><span class="p">,</span> <span class="n">fileprefix</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Feature Mapping&quot;</span><span class="p">)</span>

        <span class="c1">#if crossvalidation is enabled, we also have to map the crossvalidation file</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">getConfigBoolean</span><span class="p">(</span><span class="s2">&quot;Evaluation&quot;</span><span class="p">,</span> <span class="s2">&quot;enableCrossEvaluation&quot;</span><span class="p">)):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1">#we need to get the cross validation file that had been moved into the intermediate folder</span>
            <span class="n">crossValidationPath</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;crossVal_preprocessing&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;ready/&quot;</span>
            <span class="n">crossValidationFile</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;Evaluation&quot;</span><span class="p">,</span> <span class="s2">&quot;crossEvaluationData&quot;</span><span class="p">)</span>
            <span class="n">crossValFilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">crossValidationFile</span><span class="p">)</span>
            <span class="n">crossValFilepath</span> <span class="o">=</span> <span class="n">crossValidationPath</span> <span class="o">+</span> <span class="n">crossValFilename</span>
            <span class="n">crossValData</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">crossValFilepath</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">mapped_crossValData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureMapper</span><span class="o">.</span><span class="n">mapFeatures</span><span class="p">(</span><span class="n">crossValData</span><span class="p">,</span> <span class="n">pathways</span><span class="p">)</span>
            <span class="n">crossvalFileprefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">crossValFilepath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">crossval_mapped_filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeMappedFile</span><span class="p">(</span><span class="n">mapped_crossValData</span><span class="p">,</span> <span class="n">crossvalFileprefix</span><span class="p">)</span>

            <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;CrossValidation Feature Mapping&quot;</span><span class="p">)</span>

        <span class="n">overallend</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">overallstart</span><span class="p">,</span> <span class="n">overallend</span><span class="p">,</span> <span class="s2">&quot;Feature Selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">flushLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; finished ########################&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputFile</span></div></div>

<span class="c1">############################### FILTER ###############################</span>

<div class="viewcode-block" id="RandomSelector"><a class="viewcode-back" href="../comprior.html#featureselection.RandomSelector">[docs]</a><span class="k">class</span> <span class="nc">RandomSelector</span><span class="p">(</span><span class="n">FeatureSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Baseline Selector: Randomly selects any features.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Random&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="RandomSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.RandomSelector.selectFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Randomly select any features from the feature space.</span>
<span class="sd">           Assigns a score of 0.0 to every feature</span>

<span class="sd">           :returns: absolute path to the ranking file.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;... ########################&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="n">outFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="c1">#randomly pick any features</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

        <span class="n">max_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">min_index</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">shuffled_indices</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">min_index</span><span class="p">,</span> <span class="n">max_index</span><span class="p">),</span> <span class="n">max_index</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">header_line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">attributeName</span><span class="se">\&quot;\t\&quot;</span><span class="s2">score</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header_line</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shuffled_indices</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">header</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;\t\&quot;</span><span class="s2">0.0000</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Feature Selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">flushLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; finished ########################&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outFilename</span></div></div>

<div class="viewcode-block" id="AnovaSelector"><a class="viewcode-back" href="../comprior.html#featureselection.AnovaSelector">[docs]</a><span class="k">class</span> <span class="nc">AnovaSelector</span><span class="p">(</span><span class="n">PythonSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs ANOVA feature selection using scikit-learn implementation</span>
<span class="sd">       &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;ANOVA&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="AnovaSelector.runSelector"><a class="viewcode-back" href="../comprior.html#featureselection.AnovaSelector.runSelector">[docs]</a>    <span class="k">def</span> <span class="nf">runSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the ANOVA feature selector of scikit-learn.</span>
<span class="sd">           Is invoked by :meth:`PythonSelector.selectFeatures`.</span>

<span class="sd">           :param data: dataframe containing the unlabeled dataset.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param labels: numerically encoded class labels.</span>
<span class="sd">           :type labels: list of int</span>
<span class="sd">           :return: sklearn/mlxtend selector that ran the selection (containing coefficients etc.).</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="c1">#setting k to &quot;all&quot; returns all features</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">f_classif</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
        <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;ANOVA&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">selector</span></div></div>

<div class="viewcode-block" id="Variance2Selector"><a class="viewcode-back" href="../comprior.html#featureselection.Variance2Selector">[docs]</a><span class="k">class</span> <span class="nc">Variance2Selector</span><span class="p">(</span><span class="n">PythonSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs variance-based feature selection using scikit-learn.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Variance&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Variance2Selector.prepareOutput"><a class="viewcode-back" href="../comprior.html#featureselection.Variance2Selector.prepareOutput">[docs]</a>    <span class="k">def</span> <span class="nf">prepareOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transforms the selector output to a valid ranking and stores it into the specified file.</span>
<span class="sd">           We need to override this method because variance selector has no attribute scores but variances.</span>

<span class="sd">           :param outputFile: absolute path of the file to which to write the ranking.</span>
<span class="sd">           :type outputFile: str</span>
<span class="sd">           :param data: input dataset.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param selector: selector object from scikit-learn.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">variances_</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">ranking</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeRankingToFile</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Output Preparation&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Variance2Selector.runSelector"><a class="viewcode-back" href="../comprior.html#featureselection.Variance2Selector.runSelector">[docs]</a>    <span class="k">def</span> <span class="nf">runSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the actual variance-based feature selector of scikit-learn.</span>
<span class="sd">           Is invoked by :meth:`PythonSelector.selectFeatures`.</span>

<span class="sd">           :param data: dataframe containing the unlabeled dataset.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param labels: numerically encoded class labels.</span>
<span class="sd">           :type labels: list of int</span>
<span class="sd">           :return: sklearn/mlxtend selector that ran the selection (containing coefficients etc.).</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">()</span>
        <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Variance_p&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">selector</span></div></div>


<div class="viewcode-block" id="MRMRSelector"><a class="viewcode-back" href="../comprior.html#featureselection.MRMRSelector">[docs]</a><span class="k">class</span> <span class="nc">MRMRSelector</span><span class="p">(</span><span class="n">RSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs maximum Relevance minimum Redundancy (mRMR) feature selection using the mRMRe R implementation: https://cran.r-project.org/web/packages/mRMRe/index.html</span>
<span class="sd">       Actually a wrapper class for invoking the R code.</span>

<span class="sd">       :param scriptName: name of the R script to invoke.</span>
<span class="sd">       :type scriptName: str</span>
<span class="sd">       :param maxFeatures: maximum number of features to select. Currently all features (=0) are ranked..</span>
<span class="sd">       :type maxFeatures: int</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxFeatures</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;mRMR&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="MRMRSelector.createParams"><a class="viewcode-back" href="../comprior.html#featureselection.MRMRSelector.createParams">[docs]</a>    <span class="k">def</span> <span class="nf">createParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the parameters the R script requires (input file, output file, maximum number of features).</span>

<span class="sd">           :return: list of parameters to use for mRMR execution in R.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxFeatures</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">params</span></div></div>

<div class="viewcode-block" id="VarianceSelector"><a class="viewcode-back" href="../comprior.html#featureselection.VarianceSelector">[docs]</a><span class="k">class</span> <span class="nc">VarianceSelector</span><span class="p">(</span><span class="n">RSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs variance-based feature selection using R genefilter library.</span>
<span class="sd">       Actually a wrapper class for invoking the R code.</span>

<span class="sd">       :param scriptName: name of the R script to invoke.</span>
<span class="sd">       :type scriptName: str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;VB-FS&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="VarianceSelector.createParams"><a class="viewcode-back" href="../comprior.html#featureselection.VarianceSelector.createParams">[docs]</a>    <span class="k">def</span> <span class="nf">createParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the parameters the R script requires (input file, output file).</span>

<span class="sd">           :param outputFile: absolute path to the output file that will contain the ranking.</span>
<span class="sd">           :type outputFile: str</span>
<span class="sd">           :return: list of parameters to use for mRMR execution in R.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">params</span></div></div>


<div class="viewcode-block" id="InfoGainSelector"><a class="viewcode-back" href="../comprior.html#featureselection.InfoGainSelector">[docs]</a><span class="k">class</span> <span class="nc">InfoGainSelector</span><span class="p">(</span><span class="n">JavaSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs InfoGain feature selection as provided by WEKA: https://www.cs.waikato.ac.nz/ml/weka/</span>
<span class="sd">       Actually a wrapper class for invoking java code.</span>
<span class="sd">       &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;InfoGain&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="InfoGainSelector.createParams"><a class="viewcode-back" href="../comprior.html#featureselection.InfoGainSelector.createParams">[docs]</a>    <span class="k">def</span> <span class="nf">createParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the parameters the java program requires (input file, output file, selector name).</span>

<span class="sd">           :return: list of parameters to use for InfoGain execution in java.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;InfoGain&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">params</span></div></div>

<div class="viewcode-block" id="ReliefFSelector"><a class="viewcode-back" href="../comprior.html#featureselection.ReliefFSelector">[docs]</a><span class="k">class</span> <span class="nc">ReliefFSelector</span><span class="p">(</span><span class="n">JavaSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs ReliefF feature selection as provided by WEKA: https://www.cs.waikato.ac.nz/ml/weka/</span>
<span class="sd">       Actually a wrapper class for invoking java code.</span>
<span class="sd">       &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;ReliefF&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ReliefFSelector.createParams"><a class="viewcode-back" href="../comprior.html#featureselection.ReliefFSelector.createParams">[docs]</a>    <span class="k">def</span> <span class="nf">createParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the parameters the java program requires (input file, output file, selector name).</span>

<span class="sd">           :return: list of parameters to use for InfoGain execution in java.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;ReliefF&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">params</span></div></div>

<span class="c1">############################### FILTER - COMBINED ###############################</span>
<div class="viewcode-block" id="KbSelector"><a class="viewcode-back" href="../comprior.html#featureselection.KbSelector">[docs]</a><span class="k">class</span> <span class="nc">KbSelector</span><span class="p">(</span><span class="n">PriorKnowledgeSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Knowledge base selector.</span>
<span class="sd">       Selects features exclusively based the information retrieved from a knowledge base.</span>

<span class="sd">       :param knowledgebase: instance of a knowledge base.</span>
<span class="sd">       :type knowledgebase: :class:`knowledgebases.KnowledgeBase`</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;KBonly&quot;</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">)</span>

<div class="viewcode-block" id="KbSelector.updateScores"><a class="viewcode-back" href="../comprior.html#featureselection.KbSelector.updateScores">[docs]</a>    <span class="k">def</span> <span class="nf">updateScores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">newGeneScores</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates a score entry with the new score retrieved from the knowledge base.</span>
<span class="sd">           Used by apply function.</span>

<span class="sd">           :param entry: a gene score entry consisting of the gene name and its score</span>
<span class="sd">           :type entry: :class:`pandas.Series`</span>
<span class="sd">           :param newGeneScores: dataframe containing gene scores retrieved from the knowledge base.</span>
<span class="sd">           :type newGeneScores: :class:`pandas.DataFrame`</span>
<span class="sd">           :returns: updated series element.</span>
<span class="sd">           :rtype: :class:`pandas.Series`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">gene</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">]</span>
        <span class="n">updatedGenes</span> <span class="o">=</span> <span class="n">newGeneScores</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#if the gene has a new score, update the entry</span>
        <span class="k">if</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">updatedGenes</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">newGeneScores</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">newGeneScores</span><span class="p">[</span><span class="s2">&quot;gene_symbol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gene</span><span class="p">),</span> <span class="s2">&quot;score&quot;</span><span class="p">]</span>
            <span class="c1">#necessary because we want to get the scalar value, not a series</span>
            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">entry</span></div>

<div class="viewcode-block" id="KbSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.KbSelector.selectFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Does the actual feature selection.</span>
<span class="sd">           Retrieves association scores for genes from the knowledge base based on the given search terms.</span>

<span class="sd">           :returns: absolute path to the resulting ranking file.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;... ########################&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">outputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>

        <span class="n">genes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>

        <span class="c1"># assign a minimal default score (0.000001) to all genes</span>
        <span class="n">attributeNames</span> <span class="o">=</span> <span class="n">genes</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.00001</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">genes</span><span class="p">)</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;attributeName&quot;</span><span class="p">:</span> <span class="n">attributeNames</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">scores</span><span class="p">})</span>

        <span class="n">kb_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">associatedGenes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getGeneScores</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSearchTerms</span><span class="p">())</span>
        <span class="n">kb_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">kb_start</span><span class="p">,</span> <span class="n">kb_end</span><span class="p">,</span> <span class="s2">&quot;Getting External Gene Scores&quot;</span><span class="p">)</span>

        <span class="c1"># assign association score to all genes in data</span>
        <span class="n">updated_ranking</span> <span class="o">=</span> <span class="n">ranking</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updateScores</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">newGeneScores</span> <span class="o">=</span> <span class="n">associatedGenes</span><span class="p">)</span>

        <span class="c1">#sort by score, with highest on top</span>
        <span class="n">updated_ranking</span> <span class="o">=</span> <span class="n">updated_ranking</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#save final rankings to file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeRankingToFile</span><span class="p">(</span><span class="n">updated_ranking</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Feature Selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">flushLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; finished. ########################&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputFile</span></div></div>

<div class="viewcode-block" id="KBweightedSelector"><a class="viewcode-back" href="../comprior.html#featureselection.KBweightedSelector">[docs]</a><span class="k">class</span> <span class="nc">KBweightedSelector</span><span class="p">(</span><span class="n">CombiningSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Selects features based on association scores retrieved from the knowledge base and the relevance score retrieved by the (traditional) approach.</span>
<span class="sd">       Computes the final score via tradScore * assocScore.</span>

<span class="sd">       :param knowledgebase: instance of a knowledge base.</span>
<span class="sd">       :type knowledgebase: :class:`knowledgebases.KnowledgeBase` or inheriting class</span>
<span class="sd">       :param tradApproach: any feature selector implementation to use internally, e.g. a traditional approach like ANOVA</span>
<span class="sd">       :type tradApproach: :class:`FeatureSelector`</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradApproach</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Weighted&quot;</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradApproach</span><span class="p">)</span>

<div class="viewcode-block" id="KBweightedSelector.updateScores"><a class="viewcode-back" href="../comprior.html#featureselection.KBweightedSelector.updateScores">[docs]</a>    <span class="k">def</span> <span class="nf">updateScores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">newGeneScores</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates a score entry with the new score retrieved from the knowledge base.</span>
<span class="sd">           Used by apply function.</span>

<span class="sd">           :param entry: a gene score entry consisting of the gene name and its score</span>
<span class="sd">           :type entry: :class:`pandas.Series`</span>
<span class="sd">           :param newGeneScores: dataframe containing gene scores retrieved from the knowledge base.</span>
<span class="sd">           :type newGeneScores: :class:`pandas.DataFrame`</span>
<span class="sd">           :returns: updated series element.</span>
<span class="sd">           :rtype: :class:`pandas.Series`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">gene</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">]</span>
        <span class="n">updatedGenes</span> <span class="o">=</span> <span class="n">newGeneScores</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#if the gene has a new score, update the entry</span>
        <span class="k">if</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">updatedGenes</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">newGeneScores</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">newGeneScores</span><span class="p">[</span><span class="s2">&quot;gene_symbol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gene</span><span class="p">),</span> <span class="s2">&quot;score&quot;</span><span class="p">]</span>
            <span class="c1">#necessary because we want to get the scalar value, not a series</span>
            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">entry</span></div>

<div class="viewcode-block" id="KBweightedSelector.getName"><a class="viewcode-back" href="../comprior.html#featureselection.KBweightedSelector.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the selector name (including the knowledge base and (traditional) selector).</span>

<span class="sd">           :returns: selector name.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span></div>

<div class="viewcode-block" id="KBweightedSelector.computeStatisticalRankings"><a class="viewcode-back" href="../comprior.html#featureselection.KBweightedSelector.computeStatisticalRankings">[docs]</a>    <span class="k">def</span> <span class="nf">computeStatisticalRankings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intermediateDir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the statistical relevance score of all features using the (traditional) selector.</span>

<span class="sd">           :param intermediateDir: absolute path to output directory for (traditional) selector (where to write the statistical rankings).</span>
<span class="sd">           :type intermediateDir: str</span>
<span class="sd">           :returns: dataframe with statistical ranking.</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">setParams</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">intermediateDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span><span class="p">)</span>
        <span class="n">statsRankings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">selectFeatures</span><span class="p">()</span>
        <span class="c1">#load data frame from file</span>
        <span class="n">statisticalRankings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">statsRankings</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">engine</span> <span class="o">=</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">getTimeLogs</span><span class="p">()])</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Statistical Ranking&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">statisticalRankings</span></div>

<div class="viewcode-block" id="KBweightedSelector.computeExternalRankings"><a class="viewcode-back" href="../comprior.html#featureselection.KBweightedSelector.computeExternalRankings">[docs]</a>    <span class="k">def</span> <span class="nf">computeExternalRankings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the association scores for every gene using the knowledge base.</span>
<span class="sd">           Genes for which no entry could be found receive a default score of 0.000001.</span>

<span class="sd">           :return: dataframe with statistical ranking.</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">genes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>

        <span class="c1"># assign a minimal default score (0.000001) to all genes</span>
        <span class="n">geneScores</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">genes</span><span class="p">,</span> <span class="mf">0.000001</span><span class="p">)</span>
        <span class="n">associatedGenes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getGeneScores</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSearchTerms</span><span class="p">())</span>
        <span class="c1">#assign association score to all genes in data</span>

        <span class="c1"># assign association score to all genes in data</span>
        <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">geneScores</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># check if score for gene was found in knowledge base</span>
            <span class="k">if</span> <span class="n">gene</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">associatedGenes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span>
                <span class="n">gene_entry</span> <span class="o">=</span> <span class="n">associatedGenes</span><span class="p">[</span><span class="n">associatedGenes</span><span class="p">[</span><span class="s2">&quot;gene_symbol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gene</span><span class="p">]</span>
                <span class="n">geneScores</span><span class="p">[</span><span class="n">gene</span><span class="p">]</span> <span class="o">=</span> <span class="n">gene_entry</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;External Ranking&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">geneScores</span></div>

<div class="viewcode-block" id="KBweightedSelector.combineRankings"><a class="viewcode-back" href="../comprior.html#featureselection.KBweightedSelector.combineRankings">[docs]</a>    <span class="k">def</span> <span class="nf">combineRankings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">externalRankings</span><span class="p">,</span> <span class="n">statisticalRankings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Combines score rankings from both the knowledge base and the (traditional) selector (kb_score * trad_score) to retrieve a final score for every gene.</span>

<span class="sd">           :param externalRankings: dataframe with ranking from knowledge base.</span>
<span class="sd">           :type externalRankings: :class:`pandas.DataFrame`</span>
<span class="sd">           :param statisticalRankings: dataframe with statistical ranking.</span>
<span class="sd">           :type statisticalRankings: :class:`pandas.DataFrame`</span>
<span class="sd">           :returns: dataframe with final combined ranking.</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="c1">#just take over the statistical rankings and alter the scores accordingly</span>
        <span class="n">combinedRankings</span> <span class="o">=</span> <span class="n">statisticalRankings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">features</span> <span class="o">=</span> <span class="n">statisticalRankings</span><span class="o">.</span><span class="n">index</span>
        <span class="c1">#go trough every item and combine by weighting</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="c1">#update scores - external rankings only provide feature scores, no indices</span>
            <span class="k">if</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">externalRankings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">externalScore</span> <span class="o">=</span> <span class="n">externalRankings</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#if no entry exists, set the score to be minimal to not zero up the whole equation in the end</span>
                <span class="n">externalScore</span> <span class="o">=</span> <span class="mf">0.00001</span>
            <span class="k">if</span> <span class="n">externalScore</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># if no entry exists, set the score to be minimal to not zero up the whole equation in the end</span>
                <span class="n">externalScore</span> <span class="o">=</span> <span class="mf">0.00001</span>
            <span class="n">statsScore</span> <span class="o">=</span> <span class="n">statisticalRankings</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">feature</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">]</span>
            <span class="n">combinedRankings</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">feature</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">externalScore</span> <span class="o">*</span> <span class="n">statsScore</span>

        <span class="c1">#reorder genes based on new score</span>
        <span class="n">combinedRankings</span> <span class="o">=</span> <span class="n">combinedRankings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Ranking Combination&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">combinedRankings</span></div>

<div class="viewcode-block" id="KBweightedSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.KBweightedSelector.selectFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the feature selection process.</span>
<span class="sd">           Retrieves scores from knowledge base and (traditional) selector and combines these to a single score.</span>

<span class="sd">           :returns: absolute path to final output file containing the ranking.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;... ########################&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">intermediateDir</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;intermediateDir&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>

        <span class="n">utils</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span><span class="n">intermediateDir</span><span class="p">)</span>

        <span class="n">outputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>

        <span class="c1">#compute gene rankings with traditional approaches</span>
        <span class="n">statisticalRankings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeStatisticalRankings</span><span class="p">(</span><span class="n">intermediateDir</span><span class="p">)</span>

        <span class="c1">#compute gene rankings/associations with external knowledge base</span>
        <span class="n">externalRankings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeExternalRankings</span><span class="p">()</span>

        <span class="c1">#combine ranking scores</span>
        <span class="n">combinedRankings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combineRankings</span><span class="p">(</span><span class="n">externalRankings</span><span class="p">,</span> <span class="n">statisticalRankings</span><span class="p">)</span>

        <span class="c1">#save final rankings to file</span>
        <span class="c1">#note: here the gene ids are the index, so write it to file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeRankingToFile</span><span class="p">(</span><span class="n">combinedRankings</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Feature Selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">flushLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; finished. ########################&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputFile</span></div></div>

<div class="viewcode-block" id="LassoPenalty"><a class="viewcode-back" href="../comprior.html#featureselection.LassoPenalty">[docs]</a><span class="k">class</span> <span class="nc">LassoPenalty</span><span class="p">(</span><span class="n">PriorKnowledgeSelector</span><span class="p">,</span> <span class="n">RSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs feature selection by invoking xtune R package: https://cran.r-project.org/web/packages/xtune/index.html</span>

<span class="sd">       xtune is a Lasso selector that uses feature-individual penalty scores.</span>
<span class="sd">       These penalty scores are retrieved from the knowledge base.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="n">selectFeatures</span> <span class="o">=</span> <span class="n">RSelector</span><span class="o">.</span><span class="n">selectFeatures</span> <span class="c1">#make sure the right selectFeatures method will be invoked</span>

    <span class="n">getName</span> <span class="o">=</span> <span class="n">PriorKnowledgeSelector</span><span class="o">.</span><span class="n">getName</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;LassoPenalty&quot;</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scriptName</span> <span class="o">=</span> <span class="s2">&quot;FS_LassoPenalty.R&quot;</span>

<div class="viewcode-block" id="LassoPenalty.createParams"><a class="viewcode-back" href="../comprior.html#featureselection.LassoPenalty.createParams">[docs]</a>    <span class="k">def</span> <span class="nf">createParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the parameters the xtune R script requires (input file, output file, filename containing rankings from knowledge base).</span>

<span class="sd">           :return: list of parameters to use for xtune execution in R.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">externalScore_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeExternalRankings</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">externalScore_filename</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="LassoPenalty.computeExternalRankings"><a class="viewcode-back" href="../comprior.html#featureselection.LassoPenalty.computeExternalRankings">[docs]</a>    <span class="k">def</span> <span class="nf">computeExternalRankings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the association scores for each feature based on the scores retrieved from the knowledge base.</span>
<span class="sd">           Features that could not be found in the knowledge base receive a default score of 0.000001.</span>

<span class="sd">           :return: absolute path to the file containing the external rankings.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">intermediateOutput</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;intermediateDir&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>

        <span class="n">utils</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span><span class="n">intermediateOutput</span><span class="p">)</span>
        <span class="n">genes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>
        <span class="c1"># assign a minimal default score (0.000001) to all genes</span>
        <span class="n">geneScores</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">genes</span><span class="p">,</span> <span class="mf">0.000001</span><span class="p">)</span>
        <span class="n">associatedGenes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getGeneScores</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSearchTerms</span><span class="p">())</span>

        <span class="c1">#assign association score to all genes in data</span>
        <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">geneScores</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1">#check if score for gene was found in knowledge base</span>
            <span class="k">if</span> <span class="n">gene</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">associatedGenes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">gene_entry</span> <span class="o">=</span> <span class="n">associatedGenes</span><span class="p">[</span><span class="n">associatedGenes</span><span class="p">[</span><span class="s2">&quot;gene_symbol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gene</span><span class="p">]</span>
                <span class="n">geneScores</span><span class="p">[</span><span class="n">gene</span><span class="p">]</span> <span class="o">=</span> <span class="n">gene_entry</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">#write gene scores to file</span>

        <span class="n">scores_filename</span> <span class="o">=</span> <span class="n">intermediateOutput</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_scores.csv&quot;</span>
        <span class="n">scores_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">geneScores</span><span class="p">,</span> <span class="n">orient</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">])</span>
        <span class="n">scores_df</span> <span class="o">=</span> <span class="n">scores_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">scores_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">scores_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;External Ranking&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scores_filename</span></div></div>


<span class="c1">############################### WRAPPER ###############################</span>
<div class="viewcode-block" id="WrapperSelector"><a class="viewcode-back" href="../comprior.html#featureselection.WrapperSelector">[docs]</a><span class="k">class</span> <span class="nc">WrapperSelector</span><span class="p">(</span><span class="n">PythonSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Selector implementation for wrapper selectors using scikit-learn.</span>
<span class="sd">       Currently implements recursive feature eliminatin (RFE) and sequential forward selection (SFS) strategies,</span>
<span class="sd">       which can be combined with nearly any classifier offered by scikit-learn, e.g. SVM.</span>

<span class="sd">       :param selector: scikit-learn selector strategy (currently RFE and SFS)</span>
<span class="sd">       :param classifier: scikit-learn classifier to use for wrapper selection.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createClassifier</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createSelector</span><span class="p">()</span>


<div class="viewcode-block" id="WrapperSelector.createClassifier"><a class="viewcode-back" href="../comprior.html#featureselection.WrapperSelector.createClassifier">[docs]</a>    <span class="k">def</span> <span class="nf">createClassifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a classifier instance (from scikit-learn) to be used during the selection process.</span>
<span class="sd">           To enable the framework to use a new classifier, extend this method accordingly.</span>

<span class="sd">           :returns: scikit-learn classifier instance.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">classifier</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">classifierType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;KNN&quot;</span> <span class="ow">in</span> <span class="n">classifierType</span><span class="p">:</span>
            <span class="c1">#attention: assumes that KNN is followed by a number!</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">classifierType</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;KNN&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classifierType</span> <span class="o">==</span> <span class="s2">&quot;SVMl&quot;</span><span class="p">:</span><span class="c1">#SVM with linear kernel</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
        <span class="c1">#elif classifierType == &quot;SVMp&quot;:  # SVM with polynomial kernel, but it does not have coef component</span>
        <span class="c1">#    classifier = SVC(kernel=&quot;poly&quot;)</span>
        <span class="k">elif</span> <span class="n">classifierType</span> <span class="o">==</span> <span class="s2">&quot;LR&quot;</span><span class="p">:</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">classifierType</span> <span class="o">==</span> <span class="s2">&quot;NB&quot;</span><span class="p">:</span>
            <span class="c1">#use MultinomialNB because we cannot assume feature likelihood to be gaussian by default</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="n">MultinomialNB</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">classifierType</span> <span class="o">==</span> <span class="s2">&quot;ANOVA&quot;</span><span class="p">:</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="n">f_classif</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s2">&quot;No suitable classifier found for &quot;</span> <span class="o">+</span> <span class="n">classifierType</span> <span class="o">+</span> <span class="s2">&quot;. Choose between KNNx, SVMl (SVM with linear kernel), SVMp (SVM with polynomial kernel), LR, NB, ANOVA.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">classifier</span></div>

<div class="viewcode-block" id="WrapperSelector.createSelector"><a class="viewcode-back" href="../comprior.html#featureselection.WrapperSelector.createSelector">[docs]</a>    <span class="k">def</span> <span class="nf">createSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a selector instance that leads the selection process.</span>
<span class="sd">           Currently, sequential forward selection (SFS) and recursive feature elimination (RFE) are implemented.</span>
<span class="sd">           Extend this method if you want to add another selection strategy.</span>

<span class="sd">           :returns: scikit-learn selector instance.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;Gene Selection - General&quot;</span><span class="p">,</span> <span class="s2">&quot;selectKgenes&quot;</span><span class="p">)</span>
        <span class="n">selectorType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">selectorType</span> <span class="o">==</span> <span class="s2">&quot;RFE&quot;</span><span class="p">:</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">RFE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">selectorType</span> <span class="o">==</span> <span class="s2">&quot;SFS&quot;</span><span class="p">:</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">SFS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="p">,</span>
                      <span class="n">k_features</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">),</span>
                      <span class="n">forward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">floating</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span>
                      <span class="n">verbose</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                      <span class="n">n_jobs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;numCores&quot;</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="c1">#use half of the available cores</span>
                      <span class="n">cv</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">selector</span></div>

<div class="viewcode-block" id="WrapperSelector.prepareOutput"><a class="viewcode-back" href="../comprior.html#featureselection.WrapperSelector.prepareOutput">[docs]</a>    <span class="k">def</span> <span class="nf">prepareOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overwrites the inherited prepareOutput method because we need to access the particular selector&#39;s coefficients.</span>
<span class="sd">           The coefficients are extracted as feature scores and will be written to the rankings file.</span>

<span class="sd">           :param outputFile: selector name</span>
<span class="sd">           :type outputFile: str</span>
<span class="sd">           :param data: input dataset to get the feature names.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param selector: selector instance that is used during feature selection.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">coef_</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">coef_</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">est_</span><span class="o">.</span><span class="n">coef_</span>
        <span class="n">selected_columnIDs</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">ranking</span><span class="p">[</span><span class="n">selector</span><span class="o">.</span><span class="n">ranking_</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">selected_features</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">selected_columnIDs</span><span class="p">]</span>
        <span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_features</span>
        <span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">ranking</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeRankingToFile</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Prepare Output&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="WrapperSelector.runSelector"><a class="viewcode-back" href="../comprior.html#featureselection.WrapperSelector.runSelector">[docs]</a>    <span class="k">def</span> <span class="nf">runSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the actual feature selector of scikit-learn.</span>
<span class="sd">           Is invoked by :meth:`PythonSelector.selectFeatures`.</span>

<span class="sd">           :param data: dataframe containing the unlabeled dataset.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param labels: numerically encoded class labels.</span>
<span class="sd">           :type labels: list of int</span>
<span class="sd">           :return: sklearn/mlxtend selector that ran the selection (containing coefficients etc.).</span>
<span class="sd">           &quot;&quot;&quot;</span>

        <span class="c1"># do gene selection</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="c1">#adjust k to not exceed data columns</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;Gene Selection - General&quot;</span><span class="p">,</span> <span class="s2">&quot;selectKgenes&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="o">.</span><span class="n">n_features_to_select_</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="o">.</span><span class="n">k_features</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># do data scaling</span>
        <span class="n">scaling</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">scaled_data</span> <span class="o">=</span> <span class="n">scaling</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">scaled_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Wrapper Selector&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector</span></div></div>

<div class="viewcode-block" id="SVMRFESelector"><a class="viewcode-back" href="../comprior.html#featureselection.SVMRFESelector">[docs]</a><span class="k">class</span> <span class="nc">SVMRFESelector</span><span class="p">(</span><span class="n">JavaSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Executes SVM-RFE with poly-kernel.</span>
<span class="sd">       Uses an efficient java implementation from WEKA and is thus just a wrapper class to invoke the corresponding jars.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;SVMpRFE&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SVMRFESelector.createParams"><a class="viewcode-back" href="../comprior.html#featureselection.SVMRFESelector.createParams">[docs]</a>    <span class="k">def</span> <span class="nf">createParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the parameters the java program requires (input file, output file, selector name).</span>

<span class="sd">           :return: list of parameters to use for InfoGain execution in java.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;SVMpRFE&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">params</span></div></div>

<span class="c1">############################### EMBEDDED ###############################</span>
<div class="viewcode-block" id="RandomForestSelector"><a class="viewcode-back" href="../comprior.html#featureselection.RandomForestSelector">[docs]</a><span class="k">class</span> <span class="nc">RandomForestSelector</span><span class="p">(</span><span class="n">PythonSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Selector class that implements RandomForest as provided by scikit-learn.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;RandomForest&quot;</span><span class="p">)</span>

    <span class="c1">#override method because there is no scores_ attribute but instead feature_importances_</span>
<div class="viewcode-block" id="RandomForestSelector.prepareOutput"><a class="viewcode-back" href="../comprior.html#featureselection.RandomForestSelector.prepareOutput">[docs]</a>    <span class="k">def</span> <span class="nf">prepareOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overwrites the inherited prepareOutput method because we need to access the RandomForest selector&#39;s feature importances.</span>
<span class="sd">           These feature importances are extracted as feature scores and will be written to the rankings file.</span>

<span class="sd">           :param outputFile: selector name</span>
<span class="sd">           :type outputFile: str</span>
<span class="sd">           :param data: input dataset to get the feature names.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param selector: RandomForest selector instance that is used during feature selection.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">feature_importances_</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">ranking</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeRankingToFile</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Prepare Output&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RandomForestSelector.runSelector"><a class="viewcode-back" href="../comprior.html#featureselection.RandomForestSelector.runSelector">[docs]</a>    <span class="k">def</span> <span class="nf">runSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the actual feature selection using scikit-learn&#39;s RandomForest classifier.</span>
<span class="sd">           Is invoked by :meth:`PythonSelector.selectFeatures`.</span>

<span class="sd">           :param data: dataframe containing the unlabeled dataset.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param labels: numerically encoded class labels.</span>
<span class="sd">           :type labels: list of int</span>
<span class="sd">           :return: scikit-learn RandomForestClassifier that ran the selection.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="c1"># setting k to &quot;all&quot; returns all features</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Train the classifier</span>
        <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Random Forest&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">clf</span></div></div>

<div class="viewcode-block" id="LassoSelector"><a class="viewcode-back" href="../comprior.html#featureselection.LassoSelector">[docs]</a><span class="k">class</span> <span class="nc">LassoSelector</span><span class="p">(</span><span class="n">PythonSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Selector class that implements Lasso feature selection using scikit-learn.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Lasso&quot;</span><span class="p">)</span>

        <span class="c1"># override method because there is no scores_ attribute but instead feature_importances_</span>
<div class="viewcode-block" id="LassoSelector.prepareOutput"><a class="viewcode-back" href="../comprior.html#featureselection.LassoSelector.prepareOutput">[docs]</a>    <span class="k">def</span> <span class="nf">prepareOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overwrites the inherited prepareOutput method because we need to access Lasso&#39;s coefficients.</span>
<span class="sd">           These coefficients are extracted as feature scores and will be written to the rankings file.</span>

<span class="sd">           :param outputFile: selector name</span>
<span class="sd">           :type outputFile: str</span>
<span class="sd">           :param data: input dataset to get the feature names.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param selector: RandomForest selector instance that is used during feature selection.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">coef_</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">ranking</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeRankingToFile</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Prepare Output&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LassoSelector.runSelector"><a class="viewcode-back" href="../comprior.html#featureselection.LassoSelector.runSelector">[docs]</a>    <span class="k">def</span> <span class="nf">runSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the actual Lasso feature selector using scikit-learn.</span>
<span class="sd">           Is invoked by :meth:`PythonSelector.selectFeatures`.</span>

<span class="sd">           :param data: dataframe containing the unlabeled dataset.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param labels: numerically encoded class labels.</span>
<span class="sd">           :type labels: list of int</span>
<span class="sd">           :return: Lasso selector that ran the selection.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="c1"># setting k to &quot;all&quot; returns all features</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">clf</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">()</span>
        <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Lasso&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">clf</span></div></div>


<span class="c1">############################### INTEGRATIVE ###############################</span>
<div class="viewcode-block" id="PreFilterSelector"><a class="viewcode-back" href="../comprior.html#featureselection.PreFilterSelector">[docs]</a><span class="k">class</span> <span class="nc">PreFilterSelector</span><span class="p">(</span><span class="n">CombiningSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies a two-level prefiltering strategy for feature selection.</span>
<span class="sd">       Filters all features that were not retrieved by a knowledge base based on the search terms provided in the config file.</span>
<span class="sd">       Applies a (traditional) feature selector on the remaining features afterwards.</span>

<span class="sd">       For traditional univariate filter approaches, the results retrieved by this class and :class:`PostFilterSelector` will be the same.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradApproach</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Prefilter&quot;</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradApproach</span><span class="p">)</span>

<div class="viewcode-block" id="PreFilterSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.PreFilterSelector.selectFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Carries out feature selection.</span>
<span class="sd">           First queries the assigned knowledge base to get genes that are associated to the given search terms.</span>
<span class="sd">           Filter feature set of input data set to contain only features that are in the retrieved gene set.</span>
<span class="sd">           Apply (traditional) selector on the filtered data set.</span>

<span class="sd">           :returns: absolute path to rankings file.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;... ########################&quot;</span><span class="p">)</span>

        <span class="n">intermediateOutput</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;intermediateDir&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span><span class="n">intermediateOutput</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">externalGenes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getRelevantGenes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSearchTerms</span><span class="p">())</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Getting Relevant Genes&quot;</span><span class="p">)</span>

        <span class="n">outputFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>

        <span class="c1">#stop if no genes could be found for filtering</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">externalGenes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">outputFilename</span>

        <span class="c1">#filter input by externalGenes, keep classLabel and sampleID</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="n">finalCols</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># filter externalGenes by genes available in the rankings</span>
        <span class="n">dataGenes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
        <span class="n">sharedGenes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataGenes</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">externalGenes</span><span class="p">))</span>
        <span class="n">finalCols</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sharedGenes</span><span class="p">)</span>
        <span class="n">filteredMatrix</span> <span class="o">=</span>  <span class="n">matrix</span><span class="p">[</span><span class="n">finalCols</span><span class="p">]</span>
        <span class="c1">#write to file and set this as new input</span>
        <span class="n">filtered_input</span> <span class="o">=</span> <span class="n">intermediateOutput</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="n">filteredMatrix</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filtered_input</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">setParams</span><span class="p">(</span><span class="n">filtered_input</span><span class="p">,</span> <span class="n">intermediateOutput</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span><span class="p">)</span>
        <span class="n">rankingFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">selectFeatures</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">getTimeLogs</span><span class="p">()])</span>

        <span class="c1">#rename ranking file so that we can recognize it in the output files</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">rankingFile</span><span class="p">,</span> <span class="n">outputFilename</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Feature Selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">flushLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; finished. ########################&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputFilename</span></div></div>

<div class="viewcode-block" id="PostFilterSelector"><a class="viewcode-back" href="../comprior.html#featureselection.PostFilterSelector">[docs]</a><span class="k">class</span> <span class="nc">PostFilterSelector</span><span class="p">(</span><span class="n">CombiningSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies a two-level postfiltering strategy for feature selection.</span>
<span class="sd">       Applies (traditional) feature selection to the input data set.</span>
<span class="sd">       Afterwards, removes all genes for which no information in the corresponding knowledge base was found based on the search terms provided in the config file.</span>
<span class="sd">       For traditional univariate filter approaches, the results retrieved by this class and :class:`PreFilterSelector` will be the same.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradApproach</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Postfilter&quot;</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradApproach</span><span class="p">)</span>

<div class="viewcode-block" id="PostFilterSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.PostFilterSelector.selectFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Carries out feature selection.</span>
<span class="sd">           First executes (traditional) selector.</span>
<span class="sd">           Then queries the assigned knowledge base to get genes that are associated to the given search terms.</span>
<span class="sd">           Finally filters feature set to contain only features that are in the retrieved gene set.</span>

<span class="sd">           :returns: absolute path to rankings file.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;... ########################&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">intermediateOutput</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span>
                                                    <span class="s2">&quot;intermediateDir&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span><span class="n">intermediateOutput</span><span class="p">)</span>

        <span class="n">outputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">setParams</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">intermediateOutput</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span><span class="p">)</span>
        <span class="n">rankingFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">selectFeatures</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">getTimeLogs</span><span class="p">()])</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">loadRanking</span><span class="p">(</span><span class="n">rankingFile</span><span class="p">)</span>

        <span class="n">kb_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="c1">#filter ranking by genes from knowledge base</span>
        <span class="n">externalGenes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getRelevantGenes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSearchTerms</span><span class="p">())</span>
        <span class="n">kb_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">kb_start</span><span class="p">,</span> <span class="n">kb_end</span><span class="p">,</span> <span class="s2">&quot;Getting Relevant Genes&quot;</span><span class="p">)</span>

        <span class="c1">#filter externalGenes by genes available in the rankings</span>
        <span class="n">dataGenes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">])</span>
        <span class="n">sharedGenes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataGenes</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">externalGenes</span><span class="p">))</span>
        <span class="n">filteredRanking</span> <span class="o">=</span> <span class="n">ranking</span><span class="p">[</span><span class="n">ranking</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sharedGenes</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeRankingToFile</span><span class="p">(</span><span class="n">filteredRanking</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Feature Selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">flushLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span><span class="s2">&quot;.csv&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; finished. ########################&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputFile</span></div></div>

<div class="viewcode-block" id="ExtensionSelector"><a class="viewcode-back" href="../comprior.html#featureselection.ExtensionSelector">[docs]</a><span class="k">class</span> <span class="nc">ExtensionSelector</span><span class="p">(</span><span class="n">CombiningSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Selector implementation inspired by SOFOCLES:</span>
<span class="sd">       &quot;SoFoCles: Feature filtering for microarray classification based on Gene Ontology&quot;, Papachristoudis et al., Journal of Biomedical Informatics, 2010</span>

<span class="sd">       This selector carries out (traditional) feature selection and in parallel retrieves relevant genes from a knowledge base based on the provided search terms.</span>
<span class="sd">       The ranking is then adapted by alternating the feature ranking retrieved by the (traditiona) selection approach and the externally retrieved genes.</span>
<span class="sd">       This is kind of related to an extension approach, where a feature ranking that was retrieved by a traditional approach is extended by such external genes.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradApproach</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Extension&quot;</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">tradApproach</span><span class="p">)</span>

<div class="viewcode-block" id="ExtensionSelector.selectFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.ExtensionSelector.selectFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">selectFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Carries out feature selection.</span>
<span class="sd">           Executes (traditional) selector and separately retrieves genes from the assigned knowledge base based on the search terms specified in the config.</span>
<span class="sd">           Finally merges the two feature lists alternating to form an &quot;extended&quot; feature ranking.</span>

<span class="sd">           :returns: absolute path to rankings file.</span>
<span class="sd">           :rtype: str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;... ########################&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">intermediateOutput</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;intermediateDir&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span><span class="n">intermediateOutput</span><span class="p">)</span>

        <span class="n">outputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">setParams</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">intermediateOutput</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span><span class="p">)</span>
        <span class="n">rankingFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">selectFeatures</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradSelector</span><span class="o">.</span><span class="n">getTimeLogs</span><span class="p">()])</span>

        <span class="n">trad_ranking</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">loadRanking</span><span class="p">(</span><span class="n">rankingFile</span><span class="p">)</span>
        <span class="c1"># extend ranking by genes from knowledge base</span>
        <span class="n">kb_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ext_ranking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowledgebase</span><span class="o">.</span><span class="n">getGeneScores</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSearchTerms</span><span class="p">())</span>
        <span class="n">kb_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">kb_start</span><span class="p">,</span> <span class="n">kb_end</span><span class="p">,</span> <span class="s2">&quot;Getting External Gene Scores&quot;</span><span class="p">)</span>

        <span class="c1">#select top k genes from ext_ranking</span>
        <span class="c1">#topK = int(utils.getConfigValue(&quot;Evaluation&quot;, &quot;topKmax&quot;))</span>

        <span class="c1">#rename columns</span>
        <span class="n">ext_ranking</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">,</span> <span class="s2">&quot;score_ext&quot;</span><span class="p">]</span>
        <span class="c1">#select only genes from dataset from external ranking</span>
        <span class="n">ext_ranking_genes</span> <span class="o">=</span> <span class="n">trad_ranking</span><span class="p">[</span><span class="n">trad_ranking</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ext_ranking</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">])]</span>
        <span class="c1">#join gene indices with external ranking to get index column</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">ext_ranking_genes</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">])</span>
        <span class="n">merged_ranking</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ext_ranking</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span> <span class="s2">&quot;attributeName&quot;</span><span class="p">)</span>
        <span class="n">merged_ranking</span> <span class="o">=</span> <span class="n">merged_ranking</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">,</span> <span class="s2">&quot;score_ext&quot;</span><span class="p">]]</span>
        <span class="c1">#rename score column</span>
        <span class="n">merged_ranking</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">]</span>
        <span class="c1"># sort by scores</span>
        <span class="n">merged_ranking</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ext_ranking</span> <span class="o">=</span> <span class="n">merged_ranking</span>
        <span class="c1">#ext_len = topK</span>
        <span class="c1">#if len(merged_ranking.index) &lt; topK:</span>
        <span class="c1">#    ext_len = len(merged_ranking.index)</span>

        <span class="c1">#topK_ext = merged_ranking.head(ext_len)</span>
        <span class="c1">#reset index of topK_ext (needed for interleaving)</span>

        <span class="n">ext_ranking</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext_ranking</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">trad_ranking</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">trad_ranking</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="c1">#interleave both dataframes</span>
        <span class="n">interleaved_ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">trad_ranking</span><span class="p">,</span> <span class="n">ext_ranking</span><span class="p">])</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

        <span class="c1">#remove duplicate entries and keep first occurrences</span>
        <span class="n">interleaved_ranking</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">interleaved_ranking</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">#if len(interleaved_ranking) &lt; topK:</span>
        <span class="c1">#    topK = len(interleaved_ranking)</span>
        <span class="c1">#cut ranking to topK</span>
        <span class="c1">#final_ranking = interleaved_ranking.head(topK)</span>

        <span class="c1">#adjust relevance scores of external genes so that sorting stays the same (assign score between scores of</span>
        <span class="c1">#gene before and after own rank</span>
        <span class="n">indices_to_change</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">interleaved_ranking</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices_to_change</span><span class="p">:</span>
            <span class="n">pregene_entry</span> <span class="o">=</span> <span class="n">interleaved_ranking</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,]</span>
            <span class="n">pre_score</span> <span class="o">=</span> <span class="n">pregene_entry</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">postgene_entry</span> <span class="o">=</span> <span class="n">interleaved_ranking</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,]</span>
            <span class="n">post_score</span> <span class="o">=</span> <span class="n">postgene_entry</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1">#set new score to something between scores of gene before and after in this ranking</span>
            <span class="n">gene_entry</span> <span class="o">=</span> <span class="n">interleaved_ranking</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">,]</span>
            <span class="n">gene_entry</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">pre_score</span><span class="p">,</span> <span class="n">post_score</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeRankingToFile</span><span class="p">(</span><span class="n">interleaved_ranking</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="s2">&quot;Feature Selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableLogFlush</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">flushLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLogs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loggingDir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######################## &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; finished. ########################&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outputFile</span></div></div>



<div class="viewcode-block" id="NetworkActivitySelector"><a class="viewcode-back" href="../comprior.html#featureselection.NetworkActivitySelector">[docs]</a><span class="k">class</span> <span class="nc">NetworkActivitySelector</span><span class="p">(</span><span class="n">NetworkSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Selector implementation that selects a set of pathways from the knowledge base and maps the feature space to the pathways.</span>
<span class="sd">       Pathway ranking scores are computed based on the average ANOVA p-value of its member genes and the sample classes.</span>
<span class="sd">       This method is also used by Chuang et al. and Tian et al. (Discovering statistically significant pathways in expression profiling studies)</span>
<span class="sd">       Pathway feature values are computed with an instance of :class:`FeatureMapper` or inheriting classes, whose mapping strategies can vary.</span>
<span class="sd">       If pathways should be selected according to another strategy, use this class as an example implementation to implement a new class that inherits from :class:`NetworkSelector`.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">featuremapper</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">featuremapper</span><span class="p">,</span> <span class="n">CORGSActivityMapper</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;CorgsNetworkActivity&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">featuremapper</span><span class="p">,</span> <span class="n">PathwayActivityMapper</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NetworkActivity&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NetworkActivity&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">knowledgebase</span><span class="p">,</span> <span class="n">featuremapper</span><span class="p">)</span>

<div class="viewcode-block" id="NetworkActivitySelector.selectPathways"><a class="viewcode-back" href="../comprior.html#featureselection.NetworkActivitySelector.selectPathways">[docs]</a>    <span class="k">def</span> <span class="nf">selectPathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathways</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes a pathway ranking for the input pathways.</span>
<span class="sd">           Computes a pathway score based on the average ANOVA&#39;s f-test p-values of a pathway&#39;s member genes and the sample classes.</span>

<span class="sd">           :param pathways: selector name</span>
<span class="sd">           :type pathways: str</span>
<span class="sd">           :returns: pathway ranking with pathway scores</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="c1">#this selector selects the most significant pathways according to the average t-test of its member genes and the sample classes</span>
        <span class="c1">#method used by Chuang et al. and Tian et al. (Discovering statistically significant pathways in expression profiling studies)</span>
        <span class="c1">#as we can have &gt; 2 classes, we just use ANOVA instead of t-test</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUnlabeledData</span><span class="p">()</span>

        <span class="c1"># define input params</span>
        <span class="c1"># load data</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLabels</span><span class="p">()</span>
        <span class="n">le</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">LabelEncoder</span><span class="p">()</span>
        <span class="n">numeric_labels</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="c1">#run ANOVA (if we have just 2 classes, ANOVA is equivalent to the t-test)</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">f_classif</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
        <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">numeric_labels</span><span class="p">)</span>
        <span class="n">pvals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">selector</span><span class="o">.</span><span class="n">pvalues_</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1">#for every pathway, get the average score from its member genes</span>
        <span class="n">pathway_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pathwayName</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
            <span class="n">genes</span> <span class="o">=</span> <span class="n">pathways</span><span class="p">[</span><span class="n">pathwayName</span><span class="p">]</span><span class="o">.</span><span class="n">nodes_by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="c1">#check if all genes in genes are in the pvals matrix</span>
            <span class="n">existingGenes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pvals</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">genes</span><span class="p">))</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">pvals</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">existingGenes</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">pathway_scores</span><span class="p">[</span><span class="n">pathwayName</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>

        <span class="c1"># if we do not have any pathways, stop here</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pathway_scores</span><span class="p">:</span>
            <span class="n">ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># sort pathways by score in ascending order</span>
            <span class="n">sorted_pathways</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pathway_scores</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1">#create output: a file with: feature, score, and file index</span>
            <span class="n">feature_ranking_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">sorted_pathways</span><span class="p">:</span>
                <span class="n">feature_ranking_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pathway</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pathway</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feature_ranking_list</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;attributeName&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ranking</span></div></div>





<span class="c1">############################### FEATURE MAPPERS ###############################</span>

<div class="viewcode-block" id="FeatureMapper"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureMapper">[docs]</a><span class="k">class</span> <span class="nc">FeatureMapper</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Abstract.</span>
<span class="sd">       Inherit from this class and implement :meth:`FeatureMapper.mapFeatures` to implement a new mapping strategy.</span>
<span class="sd">       Maps the feature space of the given input data to a given set of pathways.</span>
<span class="sd">       Computes a new feature value for every feature and sample based on the implemented strategy.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

<div class="viewcode-block" id="FeatureMapper.mapFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureMapper.mapFeatures">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">mapFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_data</span><span class="p">,</span> <span class="n">pathways</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract method.</span>
<span class="sd">           Implement this method when inheriting from this class.</span>
<span class="sd">           Carries out the actual feature mapping.</span>

<span class="sd">           :param original_data: the original data set of which to map the feature space.</span>
<span class="sd">           :type original_data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param pathways: dict of pathway names as keys and corresponding pathway :class:`pypath.Network` objects as values</span>
<span class="sd">           :type pathways: dict</span>
<span class="sd">           :returns: the transformed data set with new feature values</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="FeatureMapper.getUnlabeledData"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureMapper.getUnlabeledData">[docs]</a>    <span class="k">def</span> <span class="nf">getUnlabeledData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the labels from the data set.</span>

<span class="sd">           :param dataset: data set from which to remove the labels.</span>
<span class="sd">           :type dataset: :class:`pandas.DataFrame`</span>
<span class="sd">           :returns: data set without labels.</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s2">&quot;classLabel&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="FeatureMapper.getLabels"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureMapper.getLabels">[docs]</a>    <span class="k">def</span> <span class="nf">getLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the dataset labels.</span>

<span class="sd">           :param dataset: data set from which to extract the labels.</span>
<span class="sd">           :type dataset: :class:`pandas.DataFrame`</span>
<span class="sd">           :returns: label vector of the data set.</span>
<span class="sd">           :rtype: :class:`pandas.Series`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="FeatureMapper.getFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureMapper.getFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">getFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the features of a data set.</span>

<span class="sd">           :param dataset: data set from which to extract the features.</span>
<span class="sd">           :type dataset: :class:`pandas.DataFrame`</span>
<span class="sd">           :returns: feature vector of the data set.</span>
<span class="sd">           :rtype: :class:`pandas.Series`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></div>

<div class="viewcode-block" id="FeatureMapper.getSamples"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureMapper.getSamples">[docs]</a>    <span class="k">def</span> <span class="nf">getSamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all samples in a data set.</span>

<span class="sd">           :param dataset: data set from which to extract the samples.</span>
<span class="sd">           :type dataset: :class:`pandas.DataFrame`</span>
<span class="sd">           :returns: list of samples from the data set.</span>
<span class="sd">           :rtype: list</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="FeatureMapper.getPathwayGenes"><a class="viewcode-back" href="../comprior.html#featureselection.FeatureMapper.getPathwayGenes">[docs]</a>    <span class="k">def</span> <span class="nf">getPathwayGenes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathway</span><span class="p">,</span> <span class="n">genes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the intersection of a given set of genes and the genes contained in a given pathway.</span>

<span class="sd">           :param pathway: pathway object from which to get the genes.</span>
<span class="sd">           :type pathway: :class:`pypath.Network`</span>
<span class="sd">           :param genes: list of gene names.</span>
<span class="sd">           :type genes: list of str</span>
<span class="sd">           :returns: list of genes that are contained in both the pathway and the gene list.</span>
<span class="sd">           :rtype: list of str</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">pathway_genes</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes_by_label</span>
        <span class="n">contained_pathway_genes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pathway_genes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">genes</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">contained_pathway_genes</span></div></div>

<div class="viewcode-block" id="CORGSActivityMapper"><a class="viewcode-back" href="../comprior.html#featureselection.CORGSActivityMapper">[docs]</a><span class="k">class</span> <span class="nc">CORGSActivityMapper</span><span class="p">(</span><span class="n">FeatureMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pathway mapper that implements the strategy described by Lee et al.: &quot;Inferring Pathway Activity toward Precise Disease Classification&quot;</span>
<span class="sd">       Identifies CORGS genes for every pathway: uses random search to find the minimal set of genes for which the pathway activity score is maximal.</span>
<span class="sd">       First, every sample receives an activity score, which is the average expression level of the (CORGS) genes / number of genes.</span>
<span class="sd">       The computed activity scores are then used for f-testing with the class labels, and the p-values are the new pathway feature values.</span>
<span class="sd">       These steps are executed again and again until the p-values are not decreasing anymore.</span>
<span class="sd">       &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

<div class="viewcode-block" id="CORGSActivityMapper.getANOVAscores"><a class="viewcode-back" href="../comprior.html#featureselection.CORGSActivityMapper.getANOVAscores">[docs]</a>    <span class="k">def</span> <span class="nf">getANOVAscores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Applies ANOVA f-test to test the association/correlation of a feature (pathway) with a given label.</span>
<span class="sd">           The feature has activity scores (computed from CORGS genes) for every sample, which are to be tested for the labels.</span>

<span class="sd">           :param data: the data set which to test for correlation with the labels (typically feature scores of a pathway for samples).</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param labels: class labels to use for f-test.</span>
<span class="sd">           :type labels: :class:`pandas.Series`</span>

<span class="sd">           :returns: series of p-values for every sample.</span>
<span class="sd">           :rtype: :class:`pandas.Series`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">le</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">LabelEncoder</span><span class="p">()</span>
        <span class="n">numeric_labels</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="c1"># run ANOVA (if we have just 2 classes, ANOVA is equivalent to the t-test)</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">f_classif</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
            <span class="n">genes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">genes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numeric_labels</span><span class="p">)</span>
        <span class="n">pvals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">selector</span><span class="o">.</span><span class="n">pvalues_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">genes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pvals</span></div>

<div class="viewcode-block" id="CORGSActivityMapper.computeActivityScore"><a class="viewcode-back" href="../comprior.html#featureselection.CORGSActivityMapper.computeActivityScore">[docs]</a>    <span class="k">def</span> <span class="nf">computeActivityScore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampleExpressionLevels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the activity score of a given set of genes for a specific sample.</span>
<span class="sd">           The activity score of a sample is the mean expression value of the given genes divided by the overall number of given genes.</span>

<span class="sd">           :param sampleExpressionLevels: data set containing expression levels from a given set of genes for samples.</span>
<span class="sd">           :type sampleExpressionLevels: :class:`pandas.DataFrame`</span>
<span class="sd">           :returns: activity scores for the given samples.</span>
<span class="sd">           :rtype: :class:`pandas.Series`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="c1">#activityScore for a sample is the average expression level of the genes / number of genes</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sampleExpressionLevels</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sampleExpressionLevels</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="CORGSActivityMapper.computeActivityVector"><a class="viewcode-back" href="../comprior.html#featureselection.CORGSActivityMapper.computeActivityVector">[docs]</a>    <span class="k">def</span> <span class="nf">computeActivityVector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expressionLevels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the activity score of a given set of genes for a all samples.</span>

<span class="sd">           :param expressionLevels: input data set of expression levels for a given set of (CORGS) genes.</span>
<span class="sd">           :type expressionLevels: :class:`pandas.DataFrame`</span>
<span class="sd">           :returns: instance of a feature selector implementation.</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame` or inheriting class</span>
<span class="sd">           &quot;&quot;&quot;</span>

        <span class="n">activityVector</span> <span class="o">=</span> <span class="n">expressionLevels</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">computeActivityScore</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">activityVector</span></div>


<div class="viewcode-block" id="CORGSActivityMapper.mapFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.CORGSActivityMapper.mapFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">mapFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_data</span><span class="p">,</span> <span class="n">pathways</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Carries out the actual feature mapping.</span>
<span class="sd">           Follows the strategy described by Lee et al.: &quot;Inferring Pathway Activity toward Precise Disease Classification&quot;</span>
<span class="sd">           Identifies CORGS genes for every pathway: uses random search to find the minimal set of genes for which the pathway activity score is maximal.</span>
<span class="sd">           First, every sample receives an activity score, which is the average expression level of the (CORGS) genes / number of genes.</span>
<span class="sd">           The computed activity scores are then used for f-testing with the class labels, and the p-values are the new pathway feature values.</span>
<span class="sd">           These steps are executed again and again until the p-values are not decreasing anymore.</span>

<span class="sd">           :param original_data: the original data set of which to map the feature space.</span>
<span class="sd">           :type original_data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param pathways: dict of pathway names as keys and corresponding pathway :class:`pypath.Network` objects as values</span>
<span class="sd">           :type pathways: dict</span>
<span class="sd">           :returns: the transformed data set with new feature values</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="c1"># create pathway activity score S(G) for pathway x and sample y:</span>
        <span class="c1"># find minimal set of genes G so that S(G) is locally maximal</span>
        <span class="n">unlabeledData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUnlabeledData</span><span class="p">(</span><span class="n">original_data</span><span class="p">)</span>
        <span class="n">genes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">(</span><span class="n">original_data</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSamples</span><span class="p">(</span><span class="n">original_data</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLabels</span><span class="p">(</span><span class="n">original_data</span><span class="p">)</span>

        <span class="c1"># create a new dataframe that has pathways as features</span>
        <span class="n">pathways_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pathways_scores</span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">samples</span>
        <span class="n">classLabels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">original_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;classLabel&quot;</span><span class="p">])</span>

        <span class="c1"># for every pathway, compute activity score for every sample</span>
        <span class="k">for</span> <span class="n">pathwayname</span> <span class="ow">in</span> <span class="n">pathways</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># 1. map genes to network</span>
            <span class="n">pathway</span> <span class="o">=</span> <span class="n">pathways</span><span class="p">[</span><span class="n">pathwayname</span><span class="p">]</span>
            <span class="n">pathwaygenes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPathwayGenes</span><span class="p">(</span><span class="n">pathway</span><span class="p">,</span> <span class="n">genes</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pathwaygenes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="c1"># if none of the genes in the pathway are in the data, just set the pathwayscore to 0</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;No genes of pathway &quot;</span> <span class="o">+</span> <span class="n">pathwayname</span> <span class="o">+</span> <span class="s2">&quot; found in dataset for feature mapping. Assign activity score of 0.0 to all samples.&quot;</span><span class="p">)</span>
                <span class="n">corgs_activities</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1">#2. take top scored gene as seed gene and compute S(gene)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1">#set initial scores to make sure we get at least one run</span>
            <span class="n">score_k1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">score_k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">max_k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathwaygenes</span><span class="p">)</span>
            <span class="c1">#repeat while S(k+1) &gt; S(k), k = #corgs genes</span>
            <span class="c1"># stop if we have already included all genes of pathway</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">score_k1</span> <span class="o">&gt;</span> <span class="n">score_k</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;=</span> <span class="n">max_k</span><span class="p">):</span>
                <span class="c1">#former k+1 score is now our k score</span>
                <span class="n">score_k</span> <span class="o">=</span> <span class="n">score_k1</span>
                <span class="n">corgs_genes</span> <span class="o">=</span> <span class="n">pathwaygenes</span><span class="p">[:</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">corgs_activities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeActivityVector</span><span class="p">(</span><span class="n">unlabeledData</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">corgs_genes</span><span class="p">])</span>
                <span class="n">score_k1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getANOVAscores</span><span class="p">(</span><span class="n">corgs_activities</span><span class="p">,</span> <span class="n">labels</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># once greedy search has finished, collect activity scores as new pathway feature values</span>
            <span class="n">pathways_scores</span><span class="p">[</span><span class="n">pathwayname</span><span class="p">]</span> <span class="o">=</span> <span class="n">corgs_activities</span>

        <span class="c1"># create final dataframe with pathways as features</span>
        <span class="n">pathwaydata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pathways_scores</span><span class="p">)</span>
        <span class="n">pathwaydata</span> <span class="o">=</span> <span class="n">pathwaydata</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">)</span>
        <span class="c1"># add class labels to dataset</span>
        <span class="n">mappedData</span> <span class="o">=</span> <span class="n">classLabels</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pathwaydata</span><span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># 4. return new features</span>
        <span class="k">return</span> <span class="n">mappedData</span></div></div>




<div class="viewcode-block" id="PathwayActivityMapper"><a class="viewcode-back" href="../comprior.html#featureselection.PathwayActivityMapper">[docs]</a><span class="k">class</span> <span class="nc">PathwayActivityMapper</span><span class="p">(</span><span class="n">FeatureMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pathway mapper that implements a strategy that is related to Vert and Kanehisa&#39;s strategy: Vert, Jean-Philippe, and Minoru Kanehisa. &quot;Graph-driven feature extraction from microarray data using diffusion kernels and kernel CCA.&quot; NIPS. 2002.</span>
<span class="sd">       Computes pathway activity scores for every sample and pathway as new feature values.</span>
<span class="sd">       The feature value is the average of: expression level weighted by gene variance and neighbor correlation score)</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

<div class="viewcode-block" id="PathwayActivityMapper.getAverageCorrelation"><a class="viewcode-back" href="../comprior.html#featureselection.PathwayActivityMapper.getAverageCorrelation">[docs]</a>    <span class="k">def</span> <span class="nf">getAverageCorrelation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">correlations</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the average correlation from the correlations of a given gene and its neighbors.</span>

<span class="sd">           :param correlations: correlation matrix of all genes.</span>
<span class="sd">           :type correlations: :class:`pandas.DataFrame`</span>
<span class="sd">           :param gene: gene name whose average neighbor correlation to compute.</span>
<span class="sd">           :type gene: str</span>
<span class="sd">           :param neighbors: list of gene names that are neighbors of the given gene.</span>
<span class="sd">           :type neighbors: list of str</span>
<span class="sd">           :returns: average correlation value.</span>
<span class="sd">           :rtype: float</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">containedNeighbors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">correlations</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">containedNeighbors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="n">correlations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gene</span><span class="p">,</span> <span class="n">containedNeighbors</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">entries</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></div>

<div class="viewcode-block" id="PathwayActivityMapper.computeGeneVariances"><a class="viewcode-back" href="../comprior.html#featureselection.PathwayActivityMapper.computeGeneVariances">[docs]</a>    <span class="k">def</span> <span class="nf">computeGeneVariances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the variances for every gene across all samples.</span>

<span class="sd">           :param data: data set with expression values.</span>
<span class="sd">           :type data: :class:`pandas.DataFrame`</span>
<span class="sd">           :returns: variance for every gene.</span>
<span class="sd">           :rtype: :class:`pandas.Series`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">()</span>
        <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">selector</span><span class="o">.</span><span class="n">variances_</span></div>



<div class="viewcode-block" id="PathwayActivityMapper.mapFeatures"><a class="viewcode-back" href="../comprior.html#featureselection.PathwayActivityMapper.mapFeatures">[docs]</a>    <span class="k">def</span> <span class="nf">mapFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_data</span><span class="p">,</span> <span class="n">pathways</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes the actual feature mapping procedure.</span>
<span class="sd">           A feature value  is the average of (for every gene in a pathway): (expression level weighted by gene variance and neighbor correlation score)</span>

<span class="sd">           :param original_data: the original data set of which to map the feature space.</span>
<span class="sd">           :type original_data: :class:`pandas.DataFrame`</span>
<span class="sd">           :param pathways: dict of pathway names as keys and corresponding pathway :class:`pypath.Network` objects as values</span>
<span class="sd">           :type pathways: dict</span>
<span class="sd">           :returns: the transformed data set with new feature values</span>
<span class="sd">           :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="c1">#create pathway activity score for pathway x and sample y: average of all (gene expressions weighted by gene variance and neighbor correlations)</span>
        <span class="c1"># compute gene variances</span>
        <span class="n">unlabeledData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUnlabeledData</span><span class="p">(</span><span class="n">original_data</span><span class="p">)</span>
        <span class="n">genes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">(</span><span class="n">original_data</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSamples</span><span class="p">(</span><span class="n">original_data</span><span class="p">)</span>

        <span class="n">variances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeGeneVariances</span><span class="p">(</span><span class="n">unlabeledData</span><span class="p">)</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">variances</span><span class="p">,</span> <span class="n">genes</span><span class="p">)</span>
        <span class="c1"># compute correlation scores for genes</span>
        <span class="n">correlations</span> <span class="o">=</span> <span class="n">unlabeledData</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">)</span>

        <span class="c1"># create a new dataframe that has pathways as features</span>
        <span class="n">pathways_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pathways_scores</span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">samples</span>
        <span class="n">classLabels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">original_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;classLabel&quot;</span><span class="p">])</span>

        <span class="c1"># for every pathway, compute activity score for every sample</span>
        <span class="c1"># set pathways to the correct index as provided in the ranking</span>
        <span class="k">for</span> <span class="n">pathwayname</span> <span class="ow">in</span> <span class="n">pathways</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># 2. map genes to network</span>
            <span class="n">pathway</span> <span class="o">=</span> <span class="n">pathways</span><span class="p">[</span><span class="n">pathwayname</span><span class="p">]</span>
            <span class="n">pathwaygenes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPathwayGenes</span><span class="p">(</span><span class="n">pathway</span><span class="p">,</span> <span class="n">genes</span><span class="p">)</span>


            <span class="c1">#3. precompute variance and average correlations for every gene in the pathway</span>
            <span class="n">scoreparts</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">pathwaygenes</span><span class="p">:</span>
                <span class="n">variance</span> <span class="o">=</span> <span class="nb">vars</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gene</span><span class="p">]</span>
                <span class="n">geneNeighbors</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">partners</span><span class="p">(</span><span class="n">gene</span><span class="p">)</span>
                <span class="n">neighborNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">neighbor</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">geneNeighbors</span><span class="p">]</span>
                <span class="n">average_correlations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAverageCorrelation</span><span class="p">(</span><span class="n">correlations</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">neighborNames</span><span class="p">)</span>
                <span class="n">scoreparts</span><span class="p">[</span><span class="n">gene</span><span class="p">]</span> <span class="o">=</span> <span class="n">variance</span> <span class="o">*</span> <span class="n">average_correlations</span>

            <span class="c1"># 4. compute pathway activity score for every sample</span>
            <span class="n">prescores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">scoreparts</span><span class="p">)</span>
            <span class="n">pathwayscores</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pathwaygenes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="c1"># if none of the genes in the pathway are in the data, just set the pathwayscore to 0</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No genes of pathway &quot;</span> <span class="o">+</span> <span class="n">pathwayname</span> <span class="o">+</span> <span class="s2">&quot; found in dataset. Assign activity score of 0.0 to all samples.&quot;</span><span class="p">)</span>
                <span class="n">pathwayscores</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
                    <span class="n">expression_values</span> <span class="o">=</span> <span class="n">original_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample</span><span class="p">,</span> <span class="n">pathwaygenes</span><span class="p">]</span>
                    <span class="n">score</span> <span class="o">=</span> <span class="n">expression_values</span> <span class="o">*</span> <span class="n">prescores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pathwaygenes</span><span class="p">]</span>
                    <span class="c1"># activity score for pathway x and sample y: average of all (gene expressions weighted by gene variance and neighbor correlations)</span>
                    <span class="n">activityScore</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                    <span class="n">pathwayscores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">activityScore</span><span class="p">)</span>

            <span class="n">pathways_scores</span><span class="p">[</span><span class="n">pathwayname</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathwayscores</span>


        <span class="c1"># create final dataframe with pathways as features</span>
        <span class="n">pathwaydata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pathways_scores</span><span class="p">)</span>
        <span class="n">pathwaydata</span> <span class="o">=</span> <span class="n">pathwaydata</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">)</span>

        <span class="c1">#add class labels to dataset</span>
        <span class="n">mappedData</span> <span class="o">=</span> <span class="n">classLabels</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pathwaydata</span><span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># 4. return new features</span>
        <span class="k">return</span> <span class="n">mappedData</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Cindy Perscheid.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>


<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>benchutils &mdash; Comprior  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Comprior
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation and Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inputdata.html">Input Data Sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configparams.html">Configuration Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../outputstructure.html">Output Folder Structure  - Where to find what Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledgebases.html">Knowledge Bases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../priorknowledge.html">Prior Knowledge Approaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos.html">How-Tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../comprior.html">Python Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../r-doc.html">R Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../java-doc.html">Java Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">System Architecture</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Comprior</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>benchutils</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for benchutils</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">csv</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">configparser</span><span class="o">,</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">knowledgebases</span> <span class="k">as</span> <span class="nn">kbs</span>

<span class="n">metricScales</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;kappa&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="s2">&quot;AUROC&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;sensitivity&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;specificity&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;F1&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;matthewcoef&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">##### CONFIG #####</span>
<span class="n">config</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="loadConfig"><a class="viewcode-back" href="../comprior.html#benchutils.loadConfig">[docs]</a><span class="k">def</span> <span class="nf">loadConfig</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads the config files.</span>

<span class="sd">       :param path: absolute path or list of absolute paths to the config files. For multiple config files specifying the same parameters, the ones from the last config file in the list will be used.</span>
<span class="sd">       :type path: str or list of str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">config</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">_interpolation</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ExtendedInterpolation</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1">#check dependencies</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;Gene Selection - General&quot;</span><span class="p">,</span> <span class="s2">&quot;selectKgenes&quot;</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;Evaluation&quot;</span><span class="p">,</span> <span class="s2">&quot;topKmax&quot;</span><span class="p">)):</span>
       <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;selectKgenes param in Gene Selection config is smaller than topKmax param from Evaluation (topKgenes must be &gt;= topKmax). Stop here.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="getConfig"><a class="viewcode-back" href="../comprior.html#benchutils.getConfig">[docs]</a><span class="k">def</span> <span class="nf">getConfig</span><span class="p">(</span><span class="n">category</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the config entries for a particular category.</span>

<span class="sd">       :param category: category name.</span>
<span class="sd">       :type category: str</span>
<span class="sd">       :return: all parameters for that config category</span>
<span class="sd">       :rtype: dict</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">config</span>
    <span class="k">return</span> <span class="n">config</span><span class="p">[</span><span class="n">category</span><span class="p">]</span></div>

<div class="viewcode-block" id="getConfigValue"><a class="viewcode-back" href="../comprior.html#benchutils.getConfigValue">[docs]</a><span class="k">def</span> <span class="nf">getConfigValue</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the value for a given config parameter.</span>

<span class="sd">       :param category: the parameter&#39;s category name.</span>
<span class="sd">       :type category: str</span>
<span class="sd">       :param identifier: the parameter name.</span>
<span class="sd">       :type identifier: str</span>
<span class="sd">       :return: the parameter value.</span>
<span class="sd">       :rtype: str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">config</span>
    <span class="k">return</span> <span class="n">config</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">identifier</span><span class="p">]</span></div>

<div class="viewcode-block" id="getConfigBoolean"><a class="viewcode-back" href="../comprior.html#benchutils.getConfigBoolean">[docs]</a><span class="k">def</span> <span class="nf">getConfigBoolean</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the boolean value for a given config parameter.</span>

<span class="sd">       :param category: the parameter&#39;s category name.</span>
<span class="sd">       :type category: str</span>
<span class="sd">       :param identifier: the parameter name.</span>
<span class="sd">       :type identifier: str</span>
<span class="sd">       :return: the parameter boolean value.</span>
<span class="sd">       :rtype: bool</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">config</span>
    <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span></div>

<span class="c1">##### FILE READING AND WRITING #####</span>
<div class="viewcode-block" id="loadRanking"><a class="viewcode-back" href="../comprior.html#benchutils.loadRanking">[docs]</a><span class="k">def</span> <span class="nf">loadRanking</span><span class="p">(</span><span class="n">rankingFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load a feature ranking from a file.</span>

<span class="sd">       :param rankingFile: absolute path to the file containing a feature ranking.</span>
<span class="sd">       :type rankingFile: str</span>
<span class="sd">       :return: the feature ranking as a DataFrame.</span>
<span class="sd">       :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">rankingFile</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1">#in case ranking is empty, just create an empty dataframe</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">ranking</span></div>

<span class="c1">##### DIRECTORY MANAGEMENT #####</span>
<div class="viewcode-block" id="createOrClearDirectory"><a class="viewcode-back" href="../comprior.html#benchutils.createOrClearDirectory">[docs]</a><span class="k">def</span> <span class="nf">createOrClearDirectory</span><span class="p">(</span><span class="n">directoryLocation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If the provided directory location is already existing, remove all files in that directory.</span>
<span class="sd">       Create a new directory otherwise.</span>

<span class="sd">       :param directoryLocation: absolute path to the directory that must be cleared or created.</span>
<span class="sd">       :type directoryLocation: str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="c1"># create directory if not already existing</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directoryLocation</span><span class="p">):</span>
        <span class="n">createDirectory</span><span class="p">(</span><span class="n">directoryLocation</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directoryLocation</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;.gitignore&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directoryLocation</span><span class="p">,</span><span class="n">file</span><span class="p">))</span></div>

<div class="viewcode-block" id="createDirectory"><a class="viewcode-back" href="../comprior.html#benchutils.createDirectory">[docs]</a><span class="k">def</span> <span class="nf">createDirectory</span><span class="p">(</span><span class="n">directoryLocation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a directory.</span>

<span class="sd">       :param directoryLocation: absolute path to the directory to be created.</span>
<span class="sd">       :type directoryLocation: str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directoryLocation</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="removeDirectoryContent"><a class="viewcode-back" href="../comprior.html#benchutils.removeDirectoryContent">[docs]</a><span class="k">def</span> <span class="nf">removeDirectoryContent</span><span class="p">(</span><span class="n">directoryLocation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove the files inside a directory.</span>

<span class="sd">       :param directoryLocation: absolute path to the directory that must be cleared.</span>
<span class="sd">       :type directoryLocation: str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directoryLocation</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s2">&quot;.gitignore&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">removeFile</span><span class="p">(</span><span class="n">directoryLocation</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1">#no directory to delete</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="removeFile"><a class="viewcode-back" href="../comprior.html#benchutils.removeFile">[docs]</a><span class="k">def</span> <span class="nf">removeFile</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete a file.</span>

<span class="sd">       :param file: absolute path to the file that must be deleted.</span>
<span class="sd">       :type file: str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="c1">#try:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></div>
    <span class="c1">#except:</span>
    <span class="c1">#    return #No FILE to delete</span>

    <span class="c1">#remove all intermediate and result files before running anything new</span>
<div class="viewcode-block" id="cleanupResults"><a class="viewcode-back" href="../comprior.html#benchutils.cleanupResults">[docs]</a><span class="k">def</span> <span class="nf">cleanupResults</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Remove all intermediate files from former runs, e.g. generated during preprocessing or mapping.</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="n">removeDirectoryContent</span><span class="p">(</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessing&quot;</span><span class="p">))</span>
    <span class="n">removeDirectoryContent</span><span class="p">(</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessing&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;preprocessed/&quot;</span><span class="p">)</span>
    <span class="n">removeDirectoryContent</span><span class="p">(</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessing&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;ready/&quot;</span><span class="p">)</span>
    <span class="n">removeDirectoryContent</span><span class="p">(</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;crossVal_preprocessing&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;preprocessed/&quot;</span><span class="p">)</span>
    <span class="n">removeDirectoryContent</span><span class="p">(</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;crossVal_preprocessing&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;ready/&quot;</span><span class="p">)</span>
    <span class="n">removeDirectoryContent</span><span class="p">(</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;externalKbDir&quot;</span><span class="p">))</span>
    <span class="n">removeDirectoryContent</span><span class="p">(</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;intermediateDir&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;identifierMappings/&quot;</span><span class="p">)</span>
    <span class="n">removeDirectoryContent</span><span class="p">(</span><span class="n">getConfigValue</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;intermediateDir&quot;</span><span class="p">))</span></div>

<span class="c1">##### TIME LOGGING #####</span>

<div class="viewcode-block" id="createLog"><a class="viewcode-back" href="../comprior.html#benchutils.createLog">[docs]</a><span class="k">def</span> <span class="nf">createLog</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Create the logging data structure.</span>

<span class="sd">       :return: the logging data structure.</span>
<span class="sd">       :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">       &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;End&quot;</span><span class="p">,</span> <span class="s2">&quot;Duration&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="flushLog"><a class="viewcode-back" href="../comprior.html#benchutils.flushLog">[docs]</a><span class="k">def</span> <span class="nf">flushLog</span><span class="p">(</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">outputFilePath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write the whole log to a file.</span>

<span class="sd">       :param timeLogs: the logs in a DataFrame.</span>
<span class="sd">       :type timeLogs: :class:`pandas.DataFrame`</span>
<span class="sd">       :param outputFilePath: absolute path to the log file.</span>
<span class="sd">       :type outputFilePath: str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="n">timeLogs</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outputFilePath</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="log"><a class="viewcode-back" href="../comprior.html#benchutils.log">[docs]</a><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">timeLogs</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write a log entry and add it to the log data structure.</span>

<span class="sd">       :param timeLogs: logs to which the new entry should be added</span>
<span class="sd">       :type timeLogs: :class:`pandas.DataFrame`</span>
<span class="sd">       :param start:  starting time.</span>
<span class="sd">       :type start: str</span>
<span class="sd">       :param end:  ending time.</span>
<span class="sd">       :type end: str</span>
<span class="sd">       :param message: description of that entry.</span>
<span class="sd">       :type message: str</span>
<span class="sd">       :return: updated logs.</span>
<span class="sd">       :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">message</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">duration</span><span class="p">]],</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;End&quot;</span><span class="p">,</span> <span class="s2">&quot;Duration&quot;</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">timeLogs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>

<span class="c1">##### R/JAVA CODE HANDLING #####</span>

<div class="viewcode-block" id="runRCommand"><a class="viewcode-back" href="../comprior.html#benchutils.runRCommand">[docs]</a><span class="k">def</span> <span class="nf">runRCommand</span><span class="p">(</span><span class="n">rConfig</span><span class="p">,</span> <span class="n">scriptName</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run external R code.</span>

<span class="sd">       :param rConfig: R config parameters (store paths to Rscript and the R code).</span>
<span class="sd">       :type rConfig: dict</span>
<span class="sd">       :param scriptName: name of the R script to be executed.</span>
<span class="sd">       :type scriptName: str</span>
<span class="sd">       :param params: list of parameters that will be forwarded to the R script.</span>
<span class="sd">       :type params: list of str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">rConfig</span><span class="p">[</span><span class="s2">&quot;RscriptLocation&quot;</span><span class="p">],</span> <span class="n">scriptName</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">rConfig</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">])</span>
    <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span></div>

<div class="viewcode-block" id="runJavaCommand"><a class="viewcode-back" href="../comprior.html#benchutils.runJavaCommand">[docs]</a><span class="k">def</span> <span class="nf">runJavaCommand</span><span class="p">(</span><span class="n">javaConfig</span><span class="p">,</span> <span class="n">scriptName</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run external Java code.</span>

<span class="sd">       :param javaConfig: java config parameters (store paths to java and the java code).</span>
<span class="sd">       :type javaConfig: dict</span>
<span class="sd">       :param scriptName: name of the jar to be executed.</span>
<span class="sd">       :type scriptName: str</span>
<span class="sd">       :param params: list of parameters that will be forwarded to the jar.</span>
<span class="sd">       :type params: list of str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">javaConfig</span><span class="p">[</span><span class="s2">&quot;JavaLocation&quot;</span><span class="p">],</span> <span class="s2">&quot;-jar&quot;</span><span class="p">,</span> <span class="n">javaConfig</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">scriptName</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">javaConfig</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">])</span>
    <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span></div>


<div class="viewcode-block" id="mapIdentifiers"><a class="viewcode-back" href="../comprior.html#benchutils.mapIdentifiers">[docs]</a><span class="k">def</span> <span class="nf">mapIdentifiers</span><span class="p">(</span><span class="n">itemList</span><span class="p">,</span> <span class="n">originalFormat</span><span class="p">,</span> <span class="n">desiredFormat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write a log entry and add it to the log data structure.</span>

<span class="sd">       :param itemList: list of identifiers, e.g. gene names, to be mapped</span>
<span class="sd">       :type itemList: list of str</span>
<span class="sd">       :param originalFormat:  current format of the identifiers.</span>
<span class="sd">       :type originalFormat: str</span>
<span class="sd">       :param desiredFormat:  desired format to which the identifiers should be mapped.</span>
<span class="sd">       :type desiredFormat: str</span>
<span class="sd">       :return: mapping table where every item from itemList is now mapped to desiredFormat.</span>
<span class="sd">       :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">       &quot;&quot;&quot;</span>

    <span class="n">mapping</span> <span class="o">=</span> <span class="n">retrieveMappings</span><span class="p">(</span><span class="n">itemList</span><span class="p">,</span> <span class="n">originalFormat</span><span class="p">,</span> <span class="n">desiredFormat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mapping</span></div>


<div class="viewcode-block" id="mapGeneList"><a class="viewcode-back" href="../comprior.html#benchutils.mapGeneList">[docs]</a><span class="k">def</span> <span class="nf">mapGeneList</span><span class="p">(</span><span class="n">genes</span><span class="p">,</span> <span class="n">originalFormat</span><span class="p">,</span> <span class="n">desiredFormat</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Map a list of genes to the desired format.</span>

<span class="sd">       :param genes: list of gene names to be mapped</span>
<span class="sd">       :type genes: list of str</span>
<span class="sd">       :param originalFormat:  current format of the gene names.</span>
<span class="sd">       :type originalFormat: str</span>
<span class="sd">       :param desiredFormat:  desired format to which the gene names should be mapped.</span>
<span class="sd">       :type desiredFormat: str</span>
<span class="sd">       :param outputFile:  absolute path to the output file in which the mapping should be stored.</span>
<span class="sd">       :type outputFile: str</span>
<span class="sd">       :return: list of mapped gene names.</span>
<span class="sd">       :rtype: list of str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapIdentifiers</span><span class="p">(</span><span class="n">genes</span><span class="p">,</span> <span class="n">originalFormat</span><span class="p">,</span> <span class="n">desiredFormat</span><span class="p">)</span>
    <span class="n">mapped_genes</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">desiredFormat</span><span class="p">]</span>
    <span class="n">mapped_genes</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mapped_genes</span></div>


<div class="viewcode-block" id="mapRanking"><a class="viewcode-back" href="../comprior.html#benchutils.mapRanking">[docs]</a><span class="k">def</span> <span class="nf">mapRanking</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">originalFormat</span><span class="p">,</span> <span class="n">desiredFormat</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Map the feature names of a ranking to the desired format.</span>

<span class="sd">       :param ranking: DataFrame of the ranking.</span>
<span class="sd">       :type ranking: :class:`pandas.DataFrame`</span>
<span class="sd">       :param originalFormat:  current format of the feature names in the ranking.</span>
<span class="sd">       :type originalFormat: str</span>
<span class="sd">       :param desiredFormat:  desired format to which the feature names should be mapped.</span>
<span class="sd">       :type desiredFormat: str</span>
<span class="sd">       :param outputFile:  absolute path to the output file in which the mapped feature ranking should be stored.</span>
<span class="sd">       :type outputFile: str</span>
<span class="sd">       :return: mapped feature ranking.</span>
<span class="sd">       :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="n">first_col</span> <span class="o">=</span> <span class="n">ranking</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ranking</span><span class="p">[</span><span class="n">first_col</span><span class="p">])</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapIdentifiers</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">originalFormat</span><span class="p">,</span> <span class="n">desiredFormat</span><span class="p">)</span>
    <span class="n">mapped_ranking</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">ranking</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">left_on</span><span class="o">=</span><span class="n">originalFormat</span><span class="p">)</span>
    <span class="c1"># sort by orderColumn, e.g. the score</span>
    <span class="n">mapped_ranking</span> <span class="o">=</span> <span class="n">mapped_ranking</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># drop duplicate items (n:1, when two identifiers were mapped to the same name)</span>
    <span class="n">mapped_ranking</span> <span class="o">=</span> <span class="n">mapped_ranking</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">desiredFormat</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
    <span class="c1"># drop original attributeName column that contained probeset IDs</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mapped_ranking</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mapped_ranking</span> <span class="o">=</span> <span class="n">mapped_ranking</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
    <span class="c1"># rename first column with new Gene IDs to have original column name</span>
    <span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">first_col</span>
    <span class="n">mapped_ranking</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
    <span class="n">mapped_ranking</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mapped_ranking</span></div>


<div class="viewcode-block" id="retrieveMappings"><a class="viewcode-back" href="../comprior.html#benchutils.retrieveMappings">[docs]</a><span class="k">def</span> <span class="nf">retrieveMappings</span><span class="p">(</span><span class="n">itemList</span><span class="p">,</span> <span class="n">originalFormat</span><span class="p">,</span> <span class="n">desiredFormat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Query the knowledge base to map the identifiers.</span>
<span class="sd">       We have mapping via BiomaRt and gConvert available.</span>
<span class="sd">       gConvert is currently used because BiomaRt is unstable and blocks when parallel queries are sent.</span>

<span class="sd">       :param itemList: list of identifier names to be mapped</span>
<span class="sd">       :type itemList: list of str</span>
<span class="sd">       :param originalFormat:  current format of the identifiers.</span>
<span class="sd">       :type originalFormat: str</span>
<span class="sd">       :param desiredFormat:  desired format to which the identifiers should be mapped.</span>
<span class="sd">       :type desiredFormat: str</span>
<span class="sd">       :return: mapping table for all identifiers.</span>
<span class="sd">       :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="c1"># create directory and paths for mapped gene rankings</span>
    <span class="n">kbs_factory</span> <span class="o">=</span> <span class="n">kbs</span><span class="o">.</span><span class="n">KnowledgeBaseFactory</span><span class="p">()</span>
    <span class="n">mart</span> <span class="o">=</span> <span class="n">kbs_factory</span><span class="o">.</span><span class="n">createKnowledgeBase</span><span class="p">(</span><span class="s2">&quot;gConvert&quot;</span><span class="p">)</span>
    <span class="c1"># mart = kbs_factory.createKnowledgeBase(&quot;Biomart&quot;)</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mart</span><span class="o">.</span><span class="n">mapItems</span><span class="p">(</span><span class="n">itemList</span><span class="p">,</span> <span class="n">originalFormat</span><span class="p">,</span> <span class="n">desiredFormat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mapping</span></div>


<div class="viewcode-block" id="mapDataMatrix"><a class="viewcode-back" href="../comprior.html#benchutils.mapDataMatrix">[docs]</a><span class="k">def</span> <span class="nf">mapDataMatrix</span><span class="p">(</span><span class="n">inputMatrix</span><span class="p">,</span> <span class="n">genesInColumns</span><span class="p">,</span> <span class="n">originalFormat</span><span class="p">,</span> <span class="n">desiredFormat</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">labeled</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Map the features of a data set to the desired format.</span>

<span class="sd">       :param inputMatrix: DataFrame of the ranking.</span>
<span class="sd">       :type inputMatrix: :class:`pandas.DataFrame`</span>
<span class="sd">       :param genesInColumns: if the genes/features are located in the columns.</span>
<span class="sd">       :type genesInColumns: bool</span>
<span class="sd">       :param originalFormat:  current format of the feature names in the data set.</span>
<span class="sd">       :type originalFormat: str</span>
<span class="sd">       :param desiredFormat:  desired format to which the feature names should be mapped.</span>
<span class="sd">       :type desiredFormat: str</span>
<span class="sd">       :param outputFile:  absolute path to the output file in which the mapped data set should be stored.</span>
<span class="sd">       :type outputFile: str</span>
<span class="sd">       :param labeled:  if the data matrix is additionally labeled.</span>
<span class="sd">       :type labeled: bool</span>
<span class="sd">       :return: mapped data set.</span>
<span class="sd">       :rtype: :class:`pandas.DataFrame`</span>
<span class="sd">       &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">labeled</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inputMatrix</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">inputMatrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inputMatrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapIdentifiers</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">originalFormat</span><span class="p">,</span> <span class="n">desiredFormat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">genesInColumns</span><span class="p">:</span>
        <span class="c1"># transpose matrix so that genes are in a single column that can be joined</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">inputMatrix</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">mapped_matrix</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="n">originalFormat</span><span class="p">)</span>

    <span class="c1"># drop duplicates items (1:n; when one identifier was mapped to multiple names), as otherwise we introduce redundancy to the data</span>
    <span class="n">mapped_matrix</span> <span class="o">=</span> <span class="n">mapped_matrix</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">originalFormat</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
    <span class="c1"># drop duplicates items (n:1; when multiple identifier were mapped to the same name), as otherwise we have duplicate column names</span>
    <span class="n">mapped_matrix</span> <span class="o">=</span> <span class="n">mapped_matrix</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">desiredFormat</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
    <span class="c1"># drop original attributeName column that contained probeset IDs</span>
    <span class="n">mapped_matrix</span> <span class="o">=</span> <span class="n">mapped_matrix</span><span class="p">[</span><span class="n">mapped_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="n">mapped_matrix</span> <span class="o">=</span> <span class="n">mapped_matrix</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">desiredFormat</span><span class="p">)</span>
    <span class="n">final_matrix</span> <span class="o">=</span> <span class="n">mapped_matrix</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">labeled</span><span class="p">:</span>
        <span class="n">final_matrix</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">final_matrix</span><span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">final_matrix</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">final_matrix</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Cindy Perscheid.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>